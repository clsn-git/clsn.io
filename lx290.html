<html><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="Cache-Control" content="no-transform" /><meta http-equiv="Cache-Control" content="no-siteapp" /><title>MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦» | æƒ¨ç»¿å°‘å¹´</title><meta name="description" content="ã€€ã€€MHAï¼ˆMaster High Availabilityï¼‰ç›®å‰åœ¨MySQLé«˜å¯ç”¨æ–¹é¢æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒç”±æ—¥æœ¬DeNAå…¬å¸youshimatonï¼ˆç°å°±èŒäºFacebookå…¬å¸ï¼‰å¼€å‘ï¼Œæ˜¯ä¸€å¥—ä¼˜ç§€çš„ä½œä¸ºMySQLé«˜å¯ç”¨æ€§ç¯å¢ƒä¸‹æ•…éšœåˆ‡æ¢å’Œä¸»ä»æå‡çš„é«˜å¯ç”¨è½¯ä»¶ã€‚åœ¨MySQLæ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒMHAèƒ½åšåˆ°åœ¨10~30ç§’ä¹‹å†…è‡ªåŠ¨å®Œæˆæ•°æ®åº“çš„æ•…éšœåˆ‡æ¢æ“ä½œï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæ•…éšœåˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒMHAèƒ½åœ¨æœ€å¤§ç¨‹åº¦ä¸Šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä»¥è¾¾åˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„é«˜" /><meta name="keywords" content="" /><link rel="shortcut icon" href="Frog-2.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2.png"><link rel="apple-touch-icon" sizes="114x114" href="Frog-2.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2.png" /><link rel="profile" href="11" tppabs="http://gmpg.org/xfn/11"><link rel="pingback" href="xmlrpc.php" tppabs="http://clsn.io/xmlrpc.php"><!--[if lt IE 9]><script src="/wp-content/themes/clsn-003/js/html5.js"></script><script src="/wp-content/themes/clsn-003/js/css3-mediaqueries.js"></script><![endif]--><link rel='stylesheet' id='begin-style-css' href="style.css-ver=5.2" tppabs="http://clsn.io/wp-content/themes/clsn-003/style.css?ver=5.2" type='text/css' media='all' /><link rel='stylesheet' id='fonts-css' href="fonts.css-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/css/fonts/fonts.css?ver=2017.07.26" type='text/css' media='all' /><link rel='stylesheet' id='highlight-css' href="highlight.css-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/css/highlight.css?ver=2017.07.26" type='text/css' media='all' /><script type='text/javascript' src="jquery.min.js-ver=1.10.1" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/jquery.min.js?ver=1.10.1"></script><link rel="canonical" href="lx290.html" tppabs="http://clsn.io/clsn/lx290.html" /><link rel="icon" href="Frog-2.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2.png" sizes="32x32" /><link rel="icon" href="Frog-2.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2.png" sizes="192x192" /><link rel="apple-touch-icon-precomposed" href="Frog-2.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2.png" /><meta name="msapplication-TileImage" content="/wp-content/uploads/2018/09/Frog-2.png" /></head><body class="post-template-default single single-post postid-290 single-format-standard"><div id="page" class="hfeed site"> <header id="masthead" class="site-header"> <div id="header-main" class="header-main"> <nav id="top-header"> <div class="top-nav"> <div class="menu-%e8%81%94%e7%b3%bb%e6%96%b9%e5%bc%8f-container"><ul id="menu-%e8%81%94%e7%b3%bb%e6%96%b9%e5%bc%8f" class="top-menu"><li id="menu-item-1268" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1268"><a href="index.htm" tppabs="http://clsn.io/">åšå®¢åœ°å€</a></li><li id="menu-item-1269" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1269"><a href="javascript:if(confirm('https://shang.qq.com/wpa/qunwpa?idkey=20c5455d6aaf8df9722be043588a9adda7cd9a18b6563744e4143d736559d946  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ´ËÒ»µØÖ·Ê¹ÓÃÉĞÎ´Ö§³ÖµÄĞ­Òé (ÀıÈç£¬gopher)¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='https://shang.qq.com/wpa/qunwpa?idkey=20c5455d6aaf8df9722be043588a9adda7cd9a18b6563744e4143d736559d946'" tppabs="https://shang.qq.com/wpa/qunwpa?idkey=20c5455d6aaf8df9722be043588a9adda7cd9a18b6563744e4143d736559d946">Linuxè€å¸æœº</a></li><li id="menu-item-1270" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1270"><a href="javascript:if(confirm('https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ´ËÒ»µØÖ·Ê¹ÓÃÉĞÎ´Ö§³ÖµÄĞ­Òé (ÀıÈç£¬gopher)¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&#038;email=clsn@nmtui.com'" tppabs="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&#038;email=clsn@nmtui.com">ç»™æˆ‘å‘é‚®ä»¶</a></li></ul></div> </div> </nav><!-- #top-header --> <div id="menu-box"> <div id="top-menu"> <span class="nav-search"></span> <div class="logo-site"> <p class="site-title"> <a href="index.htm" tppabs="http://clsn.io/"><img src="1-1.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/1-1.png" title="æƒ¨ç»¿å°‘å¹´" alt="æƒ¨ç»¿å°‘å¹´" rel="home" /><span class="site-name">æƒ¨ç»¿å°‘å¹´</span></a> </p> </div><!-- .logo-site --> <div id="site-nav-wrap"> <div id="sidr-close"><a href="#sidr-close" class="toggle-sidr-close">Ã—</a></div> <div id="sidr-menu"><div class="toggle-sidr-menu">MENU</a></div></div> <nav id="site-nav" class="main-nav"> <a href="#sidr-main" id="navigation-toggle" class="bars"><i class="be be-menu"></i></a> <div class="menu-%e6%83%a8%e7%bb%bf%e5%b0%91%e5%b9%b4-container"><ul id="menu-%e6%83%a8%e7%bb%bf%e5%b0%91%e5%b9%b4" class="down-menu nav-menu"><li id="menu-item-1053" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-1053"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/'" tppabs="http://clsn.io/clsn-ops/ops-linux/">è¿ç»´åŸºæœ¬åŠŸ</a><ul class="sub-menu"> <li id="menu-item-1054" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1054"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/dev-shell/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/dev-shell/'" tppabs="http://clsn.io/clsn-ops/ops-linux/dev-shell/">Shellç¼–ç¨‹</a></li> <li id="menu-item-1055" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1055"><a href="index-3.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/web-app/">Webåº”ç”¨</a></li> <li id="menu-item-1056" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1056"><a href="index-4.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/monitor/">ç›‘æ§æœåŠ¡</a></li> <li id="menu-item-1057" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1057"><a href="index-5.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/automation/">è‡ªåŠ¨åŒ–</a></li> <li id="menu-item-1058" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1058"><a href="index-6.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/storage/">å­˜å‚¨</a></li> <li id="menu-item-1059" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1059"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/acl/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/acl/'" tppabs="http://clsn.io/clsn-ops/ops-linux/acl/">å®‰å…¨</a></li></ul></li><li id="menu-item-1044" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-1044"><a href="index-8.htm" tppabs="http://clsn.io/clsn-ops/cloud/">äº‘è®¡ç®—</a><ul class="sub-menu"> <li id="menu-item-1046" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1046"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/cloud/virt/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/cloud/virt/'" tppabs="http://clsn.io/clsn-ops/cloud/virt/">è™šæ‹ŸåŒ–</a></li> <li id="menu-item-1045" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1045"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/cloud/openstack/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/cloud/openstack/'" tppabs="http://clsn.io/clsn-ops/cloud/openstack/">OpenStack</a></li></ul></li><li id="menu-item-1048" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-1048"><a href="index-11.htm" tppabs="http://clsn.io/clsn-ops/databases/">æ•°æ®åº“</a><ul class="sub-menu"> <li id="menu-item-1049" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1049"><a href="javascript:if(confirm('http://clsn.io/clsn-ops/databases/mysql/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/databases/mysql/'" tppabs="http://clsn.io/clsn-ops/databases/mysql/">MySQL</a></li> <li id="menu-item-1050" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1050"><a href="index-13.htm" tppabs="http://clsn.io/clsn-ops/databases/nosql/">NoSQL</a></li></ul></li><li id="menu-item-1052" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1052"><a href="index-14.htm" tppabs="http://clsn.io/clsn-ops/network/">ç½‘ç»œæŠ€æœ¯</a></li><li id="menu-item-1051" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1051"><a href="index-15.htm" tppabs="http://clsn.io/clsn-ops/play-linux/">ç©è½¬Linux</a></li><li id="menu-item-1047" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1047"><a href="index-16.htm" tppabs="http://clsn.io/clsn-ops/dev-ops/">æ•æ·å¼€å‘</a></li><li id="menu-item-1258" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1258"><a href="contribute-page.htm" tppabs="http://clsn.io/contribute-page">æŠ•ç¨¿</a></li></ul></div> </nav><!-- #site-nav --> </div><!-- #site-nav-wrap --> <div class="clear"></div> </div><!-- #top-menu --> </div><!-- #menu-box --> </div><!-- #menu-box --></header><!-- #masthead --><div id="search-main"> <div class="searchbar"> <form method="get" id="searchform" action="http://clsn.io/"> <span class="search-input"> <input type="text" value="" name="s" id="s" placeholder="è¾“å…¥æœç´¢å†…å®¹" required /> <button type="submit" id="searchsubmit"><i class="be be-search"></i></button> </span> </form></div> <div class="clear"></div></div> <nav class="breadcrumb"> <a class="crumbs" href="index.htm" tppabs="http://clsn.io/"><i class="be be-home"></i>é¦–é¡µ</a><i class="be be-arrowright"></i><a href="javascript:if(confirm('http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/'" tppabs="http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/" rel="category tag">Linuxè¿ç»´</a><i class="be be-arrowright"></i><a href="index-11.htm" tppabs="http://clsn.io/clsn-ops/databases/">æ•°æ®åº“</a><i class="be be-arrowright"></i><a href="javascript:if(confirm('http://clsn.io/clsn-ops/databases/mysql/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/databases/mysql/'" tppabs="http://clsn.io/clsn-ops/databases/mysql/" rel="category tag">MySQL</a><i class="be be-arrowright"></i><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/'" tppabs="http://clsn.io/clsn-ops/ops-linux/">è¿ç»´åŸºæœ¬åŠŸ</a><i class="be be-arrowright"></i><a href="index-6.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/storage/" rel="category tag">å­˜å‚¨</a><i class="be be-arrowright"></i><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/'" tppabs="http://clsn.io/clsn-ops/ops-linux/">è¿ç»´åŸºæœ¬åŠŸ</a><i class="be be-arrowright"></i><a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/acl/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/acl/'" tppabs="http://clsn.io/clsn-ops/ops-linux/acl/" rel="category tag">å®‰å…¨</a><i class="be be-arrowright"></i><a href="index-16.htm" tppabs="http://clsn.io/clsn-ops/dev-ops/" rel="category tag">æ•æ·å¼€å‘</a><i class="be be-arrowright"></i>MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦» </nav> <div id="content" class="site-content"> <div id="primary" class="content-area"> <main id="main" class="site-main" role="main"> <article id="post-290" class="post-290 post type-post status-publish format-standard hentry category-linux category-mysql category-storage category-acl category-dev-ops ury"> <header class="entry-header"> <h1 class="entry-title">MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»</h1> </header><!-- .entry-header --> <div class="entry-content"> <div class="begin-single-meta"><span class="my-date"><i class="be be-schedule"></i> 2018å¹´1æœˆ5æ—¥<i class="i-time">02:49:00</i></span><span class="comment"><a href="lx290.html#respond" tppabs="http://clsn.io/clsn/lx290.html#respond" rel="external nofollow"><i class="be be-speechbubble"></i> å‘è¡¨è¯„è®º</a></span><span class="print"><a href="javascript:printme()" target="_self" title="æ‰“å°"><i class="be be-print"></i></a></span><span class="s-hide"><a href="#"><span class="off-side"></span></a></span></div> <div class="single-content"> <div class='favorite-box'><span class='favorite-e'><a class='wpzm-link' href="javascript:if(confirm('http://clsn.io/clsn/lx290.html?wpzmaction=add&postid=290  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx290.html?wpzmaction=add&postid=290'" tppabs="http://clsn.io/clsn/lx290.html?wpzmaction=add&postid=290" rel='nofollow'> æ”¶ <i class="be be-favorite"></i> è—</a></span></div> <h2>1.1 MHAç®€ä»‹</h2>
<h3>1.1.1 MHAè½¯ä»¶ä»‹ç»</h3>
<p>ã€€ã€€MHAï¼ˆMaster High Availabilityï¼‰ç›®å‰åœ¨MySQLé«˜å¯ç”¨æ–¹é¢æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒç”±æ—¥æœ¬DeNAå…¬å¸youshimatonï¼ˆç°å°±èŒäºFacebookå…¬å¸ï¼‰å¼€å‘ï¼Œæ˜¯ä¸€å¥—ä¼˜ç§€çš„ä½œä¸ºMySQLé«˜å¯ç”¨æ€§ç¯å¢ƒä¸‹æ•…éšœåˆ‡æ¢å’Œä¸»ä»æå‡çš„é«˜å¯ç”¨è½¯ä»¶ã€‚åœ¨MySQLæ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œ<strong><span style="color: #00ff00;">MHAèƒ½åšåˆ°åœ¨10~30ç§’ä¹‹å†…è‡ªåŠ¨å®Œæˆæ•°æ®åº“çš„æ•…éšœåˆ‡æ¢æ“ä½œ</span></strong>ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæ•…éšœåˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒMHAèƒ½åœ¨æœ€å¤§ç¨‹åº¦ä¸Šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä»¥è¾¾åˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„é«˜å¯ç”¨ã€‚</p>
<p>ã€€ã€€MHAèƒ½å¤Ÿåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å®ç°è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ•…éšœè½¬ç§»ï¼Œé€šå¸¸åœ¨10-30ç§’ä»¥å†…;åœ¨å¤åˆ¶ æ¡†æ¶ä¸­ï¼ŒMHAèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¤åˆ¶è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œç”±äºä¸éœ€è¦åœ¨ç°æœ‰çš„ replicationä¸­æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨ï¼Œä»…éœ€è¦ä¸€ä¸ªmanagerèŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªManagerèƒ½ç®¡ç†å¤šå¥—å¤åˆ¶ï¼Œæ‰€ä»¥èƒ½å¤§å¤§åœ°èŠ‚çº¦æœåŠ¡å™¨çš„æ•°é‡;å¦å¤–ï¼Œå®‰è£…ç®€å•ï¼Œæ— æ€§èƒ½æŸè€—ï¼Œä»¥åŠä¸éœ€è¦ä¿®æ”¹ç° æœ‰çš„å¤åˆ¶éƒ¨ç½²ä¹Ÿæ˜¯å®ƒçš„ä¼˜åŠ¿ä¹‹å¤„ã€‚</p>
<p>ã€€ã€€MHAè¿˜æä¾›åœ¨çº¿ä¸»åº“åˆ‡æ¢çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå®‰å…¨åœ°åˆ‡æ¢å½“å‰è¿è¡Œçš„ä¸»åº“åˆ°ä¸€ä¸ªæ–°çš„ä¸»åº“ä¸­ (é€šè¿‡å°†ä»åº“æå‡ä¸ºä¸»åº“)ï¼Œå¤§æ¦‚<strong><span style="color: #00ff00;">0.5-2ç§’</span></strong>å†…å³å¯å®Œæˆã€‚</p>
<p>ã€€ã€€è¯¥è½¯ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šMHA Managerï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰å’ŒMHA Nodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰ã€‚MHA Managerå¯ä»¥å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹çš„æœºå™¨ä¸Šç®¡ç†å¤šä¸ªmaster-slaveé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ä¸€å°slaveèŠ‚ç‚¹ä¸Šã€‚MHA Nodeè¿è¡Œåœ¨æ¯å°MySQLæœåŠ¡å™¨ä¸Šï¼ŒMHA Managerä¼šå®šæ—¶æ¢æµ‹é›†ç¾¤ä¸­çš„masterèŠ‚ç‚¹ï¼Œ<span style="color: #ff0000;"><strong>å½“</strong><strong>master</strong><strong>å‡ºç°æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æœ€æ–°æ•°æ®çš„slave</strong><strong>æå‡ä¸ºæ–°çš„master</strong><strong>ï¼Œç„¶åå°†æ‰€æœ‰å…¶ä»–çš„slave</strong><strong>é‡æ–°æŒ‡å‘æ–°çš„master</strong><strong>ã€‚</strong></span>æ•´ä¸ªæ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ã€‚</p>
<blockquote>
<p>ã€€ã€€åœ¨MHAè‡ªåŠ¨æ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒMHAè¯•å›¾ä»å®•æœºçš„ä¸»æœåŠ¡å™¨ä¸Šä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿è¯æ•°æ®çš„ä¸ä¸¢å¤±ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯å¯è¡Œçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœæˆ–æ— æ³•é€šè¿‡sshè®¿é—®ï¼ŒMHAæ²¡æ³•ä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåªè¿›è¡Œæ•…éšœè½¬ç§»è€Œä¸¢å¤±äº†æœ€æ–°çš„æ•°æ®ã€‚ä½¿ç”¨MySQL 5.5çš„åŠåŒæ­¥å¤åˆ¶ï¼Œå¯ä»¥å¤§å¤§é™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p>
<p>ã€€ã€€MHAå¯ä»¥ä¸åŠåŒæ­¥å¤åˆ¶ç»“åˆèµ·æ¥ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªslaveå·²ç»æ”¶åˆ°äº†æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ŒMHAå¯ä»¥å°†æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—åº”ç”¨äºå…¶ä»–æ‰€æœ‰çš„slaveæœåŠ¡å™¨ä¸Šï¼Œå› æ­¤å¯ä»¥ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p>ã€€ã€€ç›®å‰MHAä¸»è¦æ”¯æŒä¸€ä¸»å¤šä»çš„æ¶æ„ï¼Œè¦æ­å»ºMHA,è¦æ±‚ä¸€ä¸ªå¤åˆ¶é›†ç¾¤ä¸­å¿…é¡»æœ€å°‘æœ‰ä¸‰å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œä¸€ä¸»äºŒä»ï¼Œå³ä¸€å°å……å½“masterï¼Œä¸€å°å……å½“å¤‡ç”¨masterï¼Œå¦å¤–ä¸€å°å……å½“ä»åº“ï¼Œå› ä¸ºè‡³å°‘éœ€è¦ä¸‰å°æœåŠ¡å™¨ï¼Œå‡ºäºæœºå™¨æˆæœ¬çš„è€ƒè™‘ï¼Œæ·˜å®ä¹Ÿåœ¨è¯¥åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹é€ ï¼Œç›®å‰æ·˜å®<em>TMHA</em>å·²ç»æ”¯æŒä¸€ä¸»ä¸€ä»ã€‚</p>
</blockquote>
<h3>1.1.2 MHAå·¥ä½œåŸç†</h3>
<table style="width: 100%;" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td width="16%">&nbsp;<img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230183859163-214775564.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></td>

<td width="83%">
<p><strong>å·¥ä½œåŸç†è¯´æ˜ï¼š</strong></p>
<div>
<blockquote>
<p class="a">&nbsp;</p>
<div>
<p class="a">&nbsp; &nbsp;1ã€ä¿å­˜masterä¸Šçš„æ‰€æœ‰binlogäº‹ä»¶</p>
<p class="a">&nbsp;&nbsp;&nbsp; 2ã€æ‰¾åˆ°å«æœ‰æœ€æ–°binlogä½ç½®ç‚¹çš„slave</p>
<p class="a">&nbsp;&nbsp;&nbsp; 3ã€é€šè¿‡ä¸­ç»§æ—¥å¿—å°†æ•°æ®æ¢å¤åˆ°å…¶ä»–çš„slave</p>
<p class="a">&nbsp;&nbsp;&nbsp; 4ã€å°†åŒ…å«æœ€æ–°binlogä½ç½®ç‚¹çš„slaveæå‡ä¸ºmaster</p>
<p class="a">&nbsp;&nbsp;&nbsp; 5ã€å°†å…¶ä»–ä»åº“slaveæŒ‡å‘æ–°çš„masteråŸslave01 å¹¶å¼€å¯ä¸»ä»å¤åˆ¶</p>
<p class="a">&nbsp;&nbsp;&nbsp; 6ã€å°†ä¿å­˜ä¸‹æ¥çš„binlogæ¢å¤åˆ°æ–°çš„masterä¸Š</p>
</div>
<p>&nbsp;</p>
</blockquote>
</div>
</td>
</tr>
</tbody>
</table>
<p><span style="background-color: initial; color: #333333;">1ã€ç›‘æ§æ‰€æœ‰nodeèŠ‚ç‚¹</span>MHAåŠŸèƒ½è¯´æ˜ï¼š</p>
<div>
<blockquote>
<p class="a4">2ã€è‡ªåŠ¨æ•…éšœåˆ‡æ¢(failover)</p>
<p class="a4">&nbsp; &nbsp; &nbsp;å‰ææ˜¯å¿…é¡»æœ‰ä¸‰ä¸ªèŠ‚ç‚¹å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªä»åº“</p>
<p class="a4">&nbsp;&nbsp;&nbsp; ã€€ã€€(1)é€‰ä¸»å‰æï¼ŒæŒ‰ç…§é…ç½®æ–‡ä»¶çš„é¡ºåºè¿›è¡Œï¼Œä½†æ˜¯å¦‚æœæ­¤èŠ‚ç‚¹åä¸»åº“100Mä»¥ä¸Šrelay-log å°±ä¸ä¼šé€‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp;ã€€ã€€ (2)å¦‚æœä½ è®¾ç½®äº†æƒé‡ï¼Œæ€»ä¼šåˆ‡æ¢å¸¦æ­¤èŠ‚ç‚¹ï¼›ä¸€èˆ¬åœ¨å¤šåœ°å¤šä¸­å¿ƒçš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬ä¼šæŠŠæƒé‡è®¾ç½®åœ¨æœ¬åœ°èŠ‚ç‚¹ã€‚</p>
<p class="a4">&nbsp;&nbsp;&nbsp; ã€€ã€€(3)é€‰æ‹©s1ä¸ºæ–°ä¸»</p>
<p class="a4">&nbsp;&nbsp;&nbsp; ã€€ã€€(4)ä¿å­˜ä¸»åº“binlogæ—¥å¿—</p>
<p class="a4">3ã€é‡æ–°æ„å»ºä¸»ä»</p>
<p class="a4">&nbsp;&nbsp;&nbsp; ã€€ã€€(1)å°†æœ‰é—®é¢˜çš„èŠ‚ç‚¹å‰”é™¤MHA</p>
<p class="a4">&nbsp; &nbsp; &nbsp;ã€€ã€€ã€€ã€€ è¿›è¡Œç¬¬ä¸€é˜¶æ®µæ•°æ®è¡¥å¿ï¼ŒS2ç¼ºå¤±éƒ¨åˆ†è¡¥å…¨90</p>
<p class="a4">&nbsp;&nbsp;&nbsp;ã€€ã€€ (2)s1åˆ‡æ¢è§’è‰²ä¸ºæ–°ä¸»ï¼Œå°†s2æŒ‡å‘æ–°ä¸»S1</p>
<p class="a4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ã€€ã€€ã€€ã€€&nbsp; s2&nbsp; change master to s1</p>
<p class="a4">&nbsp;&nbsp;&nbsp;ã€€ã€€ (3) ç¬¬äºŒé˜¶æ®µæ•°æ®è¡¥å¿</p>
<p class="a4">&nbsp;&nbsp;&nbsp;&nbsp;ã€€ã€€ã€€ã€€&nbsp;&nbsp;&nbsp; å°†ä¿å­˜è¿‡æ¥çš„æ–°ä¸»å’ŒåŸæœ‰ä¸»ç¼ºå¤±éƒ¨åˆ†çš„binlogï¼Œåº”ç”¨åˆ°æ–°ä¸»ã€‚</p>
<p class="a4">&nbsp;&nbsp;&nbsp; ã€€ã€€(4)è™šæ‹ŸIPæ¼‚ç§»åˆ°æ–°ä¸»ï¼Œå¯¹åº”ç”¨é€æ˜æ— æ„ŸçŸ¥</p>
<p class="a4">&nbsp;&nbsp;ã€€ã€€&nbsp; (5)é€šçŸ¥ç®¡ç†å‘˜æ•…éšœåˆ‡æ¢</p>
</blockquote>
</div>
<h3>1.1.3 MHAé«˜å¯ç”¨æ¶æ„å›¾</h3>
<p align="center"><img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230163330179-1146202670.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" />&nbsp;</p>

<h3>1.1.4 MHAå·¥å…·ä»‹ç»</h3>
<p>ã€€ã€€MHAè½¯ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒManagerå·¥å…·åŒ…å’ŒNodeå·¥å…·åŒ…ï¼Œå…·ä½“çš„è¯´æ˜å¦‚ä¸‹:</p>
<p>ã€€ã€€Managerå·¥å…·åŒ…ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š</p>
<div>
<div class="cnblogs_code">
<pre>masterha_check_ssh             #æ£€æŸ» MHA çš„ ssh<span style="color: #808080;">-</span><span style="color: #0000ff;">key</span><span style="color: #808080;">^</span><span style="color: #000000;">
masterha_check_repl            #æ£€æŸ»ä¸»ä»å¤åˆ¶æƒ…å†µ
masterha_manger                #å¯åŠ¨MHA
masterha_check_status          #æ£€æµ‹MHAçš„è¿è¡ŒçŠ¶æ€</span><span style="color: #808080;">^</span><span style="color: #000000;">
masterha_mast er_monitor       #æ£€æµ‹masteræ˜¯å¦å®•æœºä¸€
masterha_mast er_switch        #æ‰‹åŠ¨æ•…éšœè½¬ç§»&mdash;
masterha_conf_host             #æ‰‹åŠ¨æ·»åŠ serverå€æ¯ä¸€
masterha_secondary_check       #å»ºç«‹TCPè¿æ¥ä»è¿œç¨‹æœåŠ¡å™¨v
masterha_stop                  #åœæ­¢MHA</span></pre>
</div>
</div>
<p>Nodeå·¥å…·åŒ…ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š&nbsp;&nbsp;&nbsp;&nbsp;</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">save_binary_1ogs       #ä¿å­˜å®•æœºçš„masterçš„binlog
apply_diff_relay_logs   #è¯†åˆ«relay logçš„å·®å¼‚
filter_mysqlbinlog           #é˜²æ­¢å›æ»šäº‹ä»¶ä¸€MHAå·²ä¸å†ä½¿ç”¨è¿™ä¸ªå·¥å…·
purge_relay_logs           #æ¸…é™¤ä¸­ç»§æ›°å¿—ä¸€ä¸ä¼šé˜»å¡SQLçº¿ç¨‹</span></pre>
</div>
</div>
<h3>1.1.5 MHAçš„ä¼˜ç‚¹</h3>
<blockquote>
<p>1ã€è‡ªåŠ¨æ•…éšœè½¬ç§»</p>
<p>2ã€ä¸»åº“å´©æºƒä¸å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</p>
<p>3ã€ä¸éœ€è¦å¯¹å½“å‰çš„mysqlç¯å¢ƒåšé‡å¤§ä¿®æ”¹</p>
<p>4ã€ä¸éœ€è¦æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨</p>
<p>5ã€æ€§èƒ½ä¼˜ç§€ï¼Œå¯ä»¥å·¥ä½œå†åŠåŒæ­¥å’Œå¼‚æ­¥å¤åˆ¶æ¡†æ¶</p>
<p>6ã€åªè¦replicationæ”¯æŒçš„å­˜å‚¨å¼•æ“mhaéƒ½æ”¯æŒ</p>
</blockquote>
<h2>1.2 ç¯å¢ƒè¯´æ˜</h2>
<p>ã€€ ã€€åœ¨æœ¬æ¬¡çš„å®éªŒä¸­ï¼Œå…±éœ€è¦ç”¨åˆ°ä¸‰å°ä¸»æœºï¼Œç³»ç»Ÿã€è½¯ä»¶è¯´æ˜å¦‚ä¸‹ã€‚</p>
<h3>1.2.1 ç³»ç»Ÿç¯å¢ƒè¯´æ˜</h3>
<p>db01ä¸»æœºï¼ˆmasterï¼‰</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6a1805051e2a0e085a5b">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">cat</span> /etc/redhat-<span style="color: #000000;">release 
CentOS release </span><span style="color: #800080;">6.9</span><span style="color: #000000;"> (Final)
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="95e7fafae1d5f1f7a5a4">[email&#160;protected]</a> </span>~]# <span style="color: #0000ff;">uname</span> -<span style="color: #000000;">r
</span><span style="color: #800080;">2.6</span>.<span style="color: #800080;">32</span>-<span style="color: #800080;">696</span><span style="color: #000000;">.el6.x86_64
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="51233e3e251135336160">[email&#160;protected]</a> </span>~]# /etc/init.d/<span style="color: #000000;">iptables status
iptables: Firewall is not running.
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2c5e4343586c484e1c1d">[email&#160;protected]</a> </span>~<span style="color: #000000;">]# getenforce 
Disabled
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b4954544f7b5f590b0a">[email&#160;protected]</a> </span>~]# <span style="color: #0000ff;">hostname</span> -<span style="color: #000000;">I
</span><span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.51</span> <span style="color: #800080;">172.16</span>.<span style="color: #800080;">1.51</span></pre>
</div>
</div>
<p>db02ä¸»æœºï¼ˆslave1ï¼‰</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('806b5b64-590d-4295-80a9-3d194005bc43')"><img id="code_img_closed_806b5b64-590d-4295-80a9-3d194005bc43" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_806b5b64-590d-4295-80a9-3d194005bc43" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('806b5b64-590d-4295-80a9-3d194005bc43',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_806b5b64-590d-4295-80a9-3d194005bc43" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a0d2cfcfd4e0c4c29092">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">cat</span> /etc/redhat-<span style="color: #000000;">release 
</span><span style="color: #008080;"> 2</span> CentOS release <span style="color: #800080;">6.9</span><span style="color: #000000;"> (Final)
</span><span style="color: #008080;"> 3</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8af8e5e5fecaeee8bab8">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">uname</span> -<span style="color: #000000;">r
</span><span style="color: #008080;"> 4</span> <span style="color: #800080;">2.6</span>.<span style="color: #800080;">32</span>-<span style="color: #800080;">696</span><span style="color: #000000;">.el6.x86_64
</span><span style="color: #008080;"> 5</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7a0815150e3a1e184a48">[email&#160;protected]</a> ~]# /etc/init.d/<span style="color: #000000;">iptables status
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">iptables: Firewall is not running.
</span><span style="color: #008080;"> 7</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3a4855554e7a5e580a08">[email&#160;protected]</a> ~<span style="color: #000000;">]# getenforce 
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">Disabled
</span><span style="color: #008080;"> 9</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="40322f2f340024227072">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">hostname</span> -<span style="color: #000000;">I
</span><span style="color: #008080;">10</span> <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.52</span> <span style="color: #800080;">172.16</span>.<span style="color: #800080;">1.52</span></pre>
</div>
<p><span class="cnblogs_code_collapse">View Code&nbsp;db02ä¸»æœºç¯å¢ƒè¯´æ˜&nbsp;</span></div>
<p>db03ä¸»æœºï¼ˆslave1ï¼ŒMHA Managesã€AtlasèŠ‚ç‚¹ï¼‰</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('128d5d81-bb1c-4450-8822-1ca59acbfcb4')"><img id="code_img_closed_128d5d81-bb1c-4450-8822-1ca59acbfcb4" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_128d5d81-bb1c-4450-8822-1ca59acbfcb4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('128d5d81-bb1c-4450-8822-1ca59acbfcb4',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_128d5d81-bb1c-4450-8822-1ca59acbfcb4" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="44362b2b300420267477">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">cat</span> /etc/redhat-<span style="color: #000000;">release 
</span><span style="color: #008080;"> 2</span> CentOS release <span style="color: #800080;">6.9</span><span style="color: #000000;"> (Final)
</span><span style="color: #008080;"> 3</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="34465b5b407450560407">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">uname</span> -<span style="color: #000000;">r
</span><span style="color: #008080;"> 4</span> <span style="color: #800080;">2.6</span>.<span style="color: #800080;">32</span>-<span style="color: #800080;">696</span><span style="color: #000000;">.el6.x86_64
</span><span style="color: #008080;"> 5</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e2908d8d96a28680d2d1">[email&#160;protected]</a> ~]# /etc/init.d/<span style="color: #000000;">iptables status
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">iptables: Firewall is not running.
</span><span style="color: #008080;"> 7</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d4a6bbbba094b0b6e4e7">[email&#160;protected]</a> ~<span style="color: #000000;">]# getenforce 
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">Disabled
</span><span style="color: #008080;"> 9</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d2a0bdbda692b6b0e2e1">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">hostname</span> -<span style="color: #000000;">I
</span><span style="color: #008080;">10</span> <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.53</span> <span style="color: #800080;">172.16</span>.<span style="color: #800080;">1.53</span></pre>
</div>
<p><span class="cnblogs_code_collapse">View Code&nbsp;&nbsp;db03ä¸»æœºç¯å¢ƒè¯´æ˜&nbsp;</span></div>
<h3>1.2.2 mysqlè½¯ä»¶è¯´æ˜</h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ä¸‰å°æœåŠ¡å™¨ä¸Šéƒ½å…¨æ–°å®‰è£…mysql 5.6.36 ï¼š</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8cad7d7ccf8dcda8889">[email&#160;protected]</a> ~]# mysql --<span style="color: #000000;">version
mysql  Ver </span><span style="color: #800080;">14.14</span> Distrib <span style="color: #800080;">5.6</span>.<span style="color: #800080;">36</span>, <span style="color: #0000ff;">for</span> Linux (x86_64) using  EditLine wrapper</pre>
</div>
<p>ã€€ã€€å…³äºmysqlæ•°æ®åº“å…·ä½“çš„å®‰è£…æ–¹æ³•å‚è€ƒï¼š<a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=http://www.cnblogs.com/clsn/p/8038964.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=http://www.cnblogs.com/clsn/p/8038964.html#_label3'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=http://www.cnblogs.com/clsn/p/8038964.html#_label3"  target="_blank">http://www.cnblogs.com/clsn/p/8038964.html#_label3</a></p>
</div>
<h2>1.3 åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶é…ç½®</h2>
<h3>1.3.1 å…ˆå†³æ¡ä»¶</h3>
<p>ã€€ã€€? ä¸»åº“å’Œä»åº“éƒ½è¦å¼€å¯binlog</p>
<p>ã€€ã€€?&nbsp;ä¸»åº“å’Œä»åº“server-idå¿…é¡»ä¸åŒ</p>
<p>ã€€ã€€?&nbsp;è¦æœ‰ä¸»ä»å¤åˆ¶ç”¨æˆ·</p>
<h3>1.3.2 é…ç½®ä¸»ä»å¤åˆ¶</h3>
<p><strong>db01 my.cnf</strong><strong>æ–‡ä»¶</strong></p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="32405d5d467256500203">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/my.cnf</span>
<span style="color: #000000;">[mysqld]
basedir</span>=/application/<span style="color: #000000;">mysql
datadir</span>=/application/mysql/<span style="color: #000000;">data
socket</span>=/tmp/<span style="color: #000000;">mysql.sock
log</span>-error=/var/log/<span style="color: #000000;">mysql.log
log</span>-bin=/data/mysql/mysql-<span style="color: #000000;">bin
binlog_format</span>=<span style="color: #000000;">row
secure</span>-file-priv=/<span style="color: #000000;">tmp 
server</span>-id=51<span style="color: #000000;">
skip</span>-name-resolve  <span style="color: #008000;">#</span><span style="color: #008000;"> è·³è¿‡åŸŸåè§£æ</span>
gtid-mode=on    <span style="color: #008000;">#</span><span style="color: #008000;"> å¯ç”¨gtidç±»å‹ï¼Œå¦åˆ™å°±æ˜¯æ™®é€šçš„å¤åˆ¶æ¶æ„</span>
enforce-gtid-consistency=true    <span style="color: #008000;">#</span><span style="color: #008000;">å¼ºåˆ¶GTIDçš„ä¸€è‡´æ€§</span>
log-slave-updates=1     <span style="color: #008000;">#</span><span style="color: #008000;"> slaveæ›´æ–°æ˜¯å¦è®°å…¥æ—¥å¿—ï¼ˆ5.6å¿…é¡»çš„ï¼‰</span>
relay_log_purge =<span style="color: #000000;"> 0 
[mysql]
socket</span>=/tmp/mysql.sock</pre>
</div>
</div>
<p><strong>db02 my.cnf</strong><strong>æ–‡ä»¶</strong></p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c5a0cfe9-93a3-44b6-ab18-bdcd7a33e080')"><img id="code_img_closed_c5a0cfe9-93a3-44b6-ab18-bdcd7a33e080" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_c5a0cfe9-93a3-44b6-ab18-bdcd7a33e080" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c5a0cfe9-93a3-44b6-ab18-bdcd7a33e080',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_c5a0cfe9-93a3-44b6-ab18-bdcd7a33e080" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="65170a0a112501075557">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/my.cnf</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">[mysqld]
</span><span style="color: #008080;"> 3</span> basedir=/application/<span style="color: #000000;">mysql
</span><span style="color: #008080;"> 4</span> datadir=/application/mysql/<span style="color: #000000;">data
</span><span style="color: #008080;"> 5</span> socket=/tmp/<span style="color: #000000;">mysql.sock
</span><span style="color: #008080;"> 6</span> log-error=/var/log/<span style="color: #000000;">mysql.log
</span><span style="color: #008080;"> 7</span> log-bin=/data/mysql/mysql-<span style="color: #000000;">bin
</span><span style="color: #008080;"> 8</span> binlog_format=<span style="color: #000000;">row
</span><span style="color: #008080;"> 9</span> secure-file-priv=/<span style="color: #000000;">tmp 
</span><span style="color: #008080;">10</span> server-id=52
<span style="color: #008080;">11</span> skip-name-<span style="color: #000000;">resolve
</span><span style="color: #008080;">12</span> gtid-mode=<span style="color: #000000;">on
</span><span style="color: #008080;">13</span> enforce-gtid-consistency=<span style="color: #000000;">true
</span><span style="color: #008080;">14</span> log-slave-updates=1
<span style="color: #008080;">15</span> relay_log_purge =<span style="color: #000000;"> 0 
</span><span style="color: #008080;">16</span> <span style="color: #000000;">[mysql]
</span><span style="color: #008080;">17</span> socket=/tmp/mysql.sock</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code&nbsp;<strong>db02 my.cnf</strong><strong>æ–‡ä»¶</strong>&nbsp;</span></div>
</div>
<p><strong>db03 my.cnf</strong><strong>æ–‡ä»¶</strong></p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c4a71fe7-ce23-4df3-8dc3-c688a7def1b6')"><img id="code_img_closed_c4a71fe7-ce23-4df3-8dc3-c688a7def1b6" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_c4a71fe7-ce23-4df3-8dc3-c688a7def1b6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c4a71fe7-ce23-4df3-8dc3-c688a7def1b6',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_c4a71fe7-ce23-4df3-8dc3-c688a7def1b6" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="afddc0c0dbefcbcd9f9c">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/my.cnf</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">[mysqld]
</span><span style="color: #008080;"> 3</span> basedir=/application/<span style="color: #000000;">mysql
</span><span style="color: #008080;"> 4</span> datadir=/application/mysql/<span style="color: #000000;">data
</span><span style="color: #008080;"> 5</span> socket=/tmp/<span style="color: #000000;">mysql.sock
</span><span style="color: #008080;"> 6</span> log-error=/var/log/<span style="color: #000000;">mysql.log
</span><span style="color: #008080;"> 7</span> log-bin=/data/mysql/mysql-<span style="color: #000000;">bin
</span><span style="color: #008080;"> 8</span> binlog_format=<span style="color: #000000;">row
</span><span style="color: #008080;"> 9</span> secure-file-priv=/<span style="color: #000000;">tmp 
</span><span style="color: #008080;">10</span> server-id=53
<span style="color: #008080;">11</span> skip-name-<span style="color: #000000;">resolve
</span><span style="color: #008080;">12</span> gtid-mode=<span style="color: #000000;">on
</span><span style="color: #008080;">13</span> enforce-gtid-consistency=<span style="color: #000000;">true
</span><span style="color: #008080;">14</span> log-slave-updates=1
<span style="color: #008080;">15</span> relay_log_purge =<span style="color: #000000;"> 0 
</span><span style="color: #008080;">16</span> skip-name-<span style="color: #000000;">resolve
</span><span style="color: #008080;">17</span> <span style="color: #000000;">[mysql]
</span><span style="color: #008080;">18</span> socket=/tmp/mysql.sock</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code db03 my.cnfæ–‡ä»¶</span></div>
</div>
<p><span style="background-color: #ffff00;">åˆ›å»ºå¤åˆ¶ç”¨æˆ· (51ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œ52ã€53ä¸ºä»)</span></p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">GRANT</span> <span style="color: #0000ff;">REPLICATION</span> SLAVE <span style="color: #0000ff;">ON</span> <span style="color: #808080;">*</span>.<span style="color: #808080;">*</span> <span style="color: #0000ff;">TO</span> <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="344651445874">[email&#160;protected]</a><span style="color: #ff0000;">'</span><span style="color: #ff0000;">10.0.0.%</span><span style="color: #ff0000;">'</span> IDENTIFIED <span style="color: #0000ff;">BY</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">123</span><span style="color: #ff0000;">'</span>;</pre>
</div>
</div>
<p>ä»åº“å¼€å¯å¤åˆ¶</p>
<div>
<div class="cnblogs_code">
<pre>change master <span style="color: #0000ff;">to</span><span style="color: #000000;"> 
    master_host</span><span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">10.0.0.51</span><span style="color: #ff0000;">'</span><span style="color: #000000;">,
    master_user</span><span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">repl</span><span style="color: #ff0000;">'</span><span style="color: #000000;">,
    master_password</span><span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">123</span><span style="color: #ff0000;">'</span><span style="color: #000000;">,
    MASTER_AUTO_POSITION</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span>;</pre>
</div>
</div>
<p>å¯åŠ¨ä»åº“å¤åˆ¶</p>
<div>
<div class="cnblogs_code">
<pre>start slave;</pre>
</div>
</div>
<h3>1.3.3 GTIDå¤åˆ¶æŠ€æœ¯è¯´æ˜</h3>
<p><span style="background-color: #ffff00;"><strong>MySQL GTID</strong><strong>ç®€ä»‹</strong></span></p>
<p>ã€€ã€€GTIDçš„å…¨ç§°ä¸º global transaction identifier ï¼Œå¯ä»¥ç¿»è¯‘ä¸ºå…¨å±€äº‹åŠ¡æ ‡ç¤ºç¬¦ï¼ŒGTIDåœ¨åŸå§‹masterä¸Šçš„äº‹åŠ¡æäº¤æ—¶è¢«åˆ›å»ºã€‚GTIDéœ€è¦åœ¨å…¨å±€çš„ä¸»-å¤‡æ‹“æ‰‘ç»“æ„ä¸­ä¿æŒå”¯ä¸€æ€§ï¼ŒGTIDç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<p>&nbsp;ã€€ã€€<span class="cnblogs_code">GTID <span style="color: #808080;">=</span> source_id:transaction_id</span>&nbsp;</p>
<p>ã€€ã€€<span style="background-color: #ffff00;"><strong>source_id</strong></span>ç”¨äºæ ‡ç¤ºæºæœåŠ¡å™¨ï¼Œç”¨server_uuidæ¥è¡¨ç¤ºï¼Œè¿™ä¸ªå€¼åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ç”Ÿæˆï¼Œå¹¶å†™å…¥åˆ°é…ç½®æ–‡ä»¶data/auto.cnfä¸­</p>
<p>ã€€ã€€<span style="background-color: #ffff00;"><strong>transaction_id</strong></span>åˆ™æ˜¯æ ¹æ®åœ¨æºæœåŠ¡å™¨ä¸Šç¬¬å‡ ä¸ªæäº¤çš„äº‹åŠ¡æ¥ç¡®å®šã€‚</p>
<p><em><span style="text-decoration: underline;">GTID</span></em><em><span style="text-decoration: underline;">äº‹ä»¶ç»“æ„</span></em></p>
<p align="center">&nbsp;<img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230164153273-855151708.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<p><em><span style="text-decoration: underline;">GTID</span></em><em><span style="text-decoration: underline;">åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„ç»“æ„</span></em></p>
<p align="center">&nbsp;<img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230164337492-336799988.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" />4</p>

<p><strong><em><span style="text-decoration: underline;">ä¸€ä¸ªGTID</span></em></strong><strong><em><span style="text-decoration: underline;">çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š</span></em></strong></p>
<div>
<blockquote>
<p class="a4">1.äº‹åŠ¡åœ¨ä¸»åº“ä¸Šæ‰§è¡Œå¹¶æäº¤ç»™äº‹åŠ¡åˆ†é…ä¸€ä¸ªgtidï¼ˆç”±ä¸»åº“çš„uuidå’Œè¯¥æœåŠ¡å™¨ä¸Šæœªä½¿ç”¨çš„æœ€å°äº‹åŠ¡åºåˆ—å·ï¼‰ï¼Œè¯¥GTIDè¢«å†™å…¥åˆ°binlogä¸­ã€‚</p>
<p class="a4">2.å¤‡åº“è¯»å–relaylogä¸­çš„gtidï¼Œå¹¶è®¾ç½®sessionçº§åˆ«çš„gtid_nextçš„å€¼ï¼Œä»¥å‘Šè¯‰å¤‡åº“ä¸‹ä¸€ä¸ªäº‹åŠ¡å¿…é¡»ä½¿ç”¨è¿™ä¸ªå€¼</p>
<p class="a4">3.å¤‡åº“æ£€æŸ¥è¯¥gtidæ˜¯å¦å·²ç»è¢«å…¶ä½¿ç”¨å¹¶è®°å½•åˆ°ä»–è‡ªå·±çš„binlogä¸­ã€‚slaveéœ€è¦æ‹…ä¿ä¹‹å‰çš„äº‹åŠ¡æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªgtidï¼Œä¹Ÿè¦æ‹…ä¿æ­¤æ—¶å·²åˆ†è¯»å–gtidï¼Œä½†æœªæäº¤çš„äº‹åŠ¡ä¹Ÿä¸æ©å‘¢è¿‡ä½¿ç”¨è¿™ä¸ªgtid.</p>
<p class="a4">4.ç”±äºgtid_nextéç©ºï¼Œslaveä¸ä¼šå»ç”Ÿæˆä¸€ä¸ªæ–°çš„gtidï¼Œè€Œæ˜¯ä½¿ç”¨ä»ä¸»åº“è·å¾—çš„gtidã€‚è¿™å¯ä»¥ä¿è¯åœ¨ä¸€ä¸ªå¤åˆ¶æ‹“æ‰‘ä¸­çš„åŒä¸€ä¸ªäº‹åŠ¡gtidä¸å˜ã€‚ç”±äºGTIDåœ¨å…¨å±€çš„å”¯ä¸€æ€§ï¼Œé€šè¿‡GTIDï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªåŠ¨åˆ‡æ¢æ—¶å¯¹ä¸€äº›å¤æ‚çš„å¤åˆ¶æ‹“æ‰‘å¾ˆæ–¹ä¾¿çš„æå‡æ–°ä¸»åº“åŠæ–°å¤‡åº“ï¼Œä¾‹å¦‚é€šè¿‡æŒ‡å‘ç‰¹å®šçš„GTIDæ¥ç¡®å®šæ–°å¤‡åº“å¤åˆ¶åæ ‡ã€‚</p>
</blockquote>
</div>
<p>ã€€ã€€ã€€ã€€GTIDæ˜¯ç”¨æ¥æ›¿ä»£ä»¥å‰classicçš„å¤åˆ¶æ–¹æ³•ï¼›</p>
<p>ã€€ã€€ã€€ã€€MySQL5.6.2æ”¯æŒ MySQL5.6.10åå®Œå–„ï¼›</p>
<p><span style="background-color: #ffff00;"><strong>GTID</strong><strong>ç›¸æ¯”ä¼ ç»Ÿå¤åˆ¶çš„ä¼˜ç‚¹ï¼š</strong></span></p>
<blockquote>
<p>1.ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€ä¸ªå”¯ä¸€IDï¼Œä¸€ä¸ªGTIDåœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šåªä¼šæ‰§è¡Œä¸€æ¬¡</p>
<p>2.GTIDæ˜¯ç”¨æ¥ä»£æ›¿ä¼ ç»Ÿå¤åˆ¶çš„æ–¹æ³•ï¼ŒGTIDå¤åˆ¶ä¸æ™®é€šå¤åˆ¶æ¨¡å¼çš„æœ€å¤§ä¸åŒå°±æ˜¯ä¸éœ€è¦æŒ‡å®šäºŒè¿›åˆ¶æ–‡ä»¶åå’Œä½ç½®</p>
<p>3.å‡å°‘æ‰‹å·¥å¹²é¢„å’Œé™ä½æœåŠ¡æ•…éšœæ—¶é—´ï¼Œå½“ä¸»æœºæŒ‚äº†ä¹‹åé€šè¿‡è½¯ä»¶ä»ä¼—å¤šçš„å¤‡æœºä¸­æå‡ä¸€å°å¤‡æœºä¸ºä¸»æœº</p>
</blockquote>
<p><strong>GTID</strong><strong>çš„é™åˆ¶ï¼š</strong></p>
<div>
<blockquote>
<p class="a4">1.ä¸æ”¯æŒéäº‹åŠ¡å¼•æ“</p>
<p class="a4">2.ä¸æ”¯æŒcreate table ... select è¯­å¥å¤åˆ¶(ä¸»åº“ç›´æ¥æŠ¥é”™)</p>
<p class="a4">ã€€ã€€åŸç†ï¼šï¼ˆ ä¼šç”Ÿæˆä¸¤ä¸ªsqlï¼Œä¸€ä¸ªæ˜¯DDLåˆ›å»ºè¡¨SQLï¼Œä¸€ä¸ªæ˜¯insert into æ’å…¥æ•°æ®çš„sqlã€‚</p>
<p class="a4">ã€€ã€€ç”±äºDDLä¼šå¯¼è‡´è‡ªåŠ¨æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªsqlè‡³å°‘éœ€è¦ä¸¤ä¸ªGTIDï¼Œä½†æ˜¯GTIDæ¨¡å¼ä¸‹ï¼Œåªèƒ½ç»™è¿™ä¸ªsqlç”Ÿæˆä¸€ä¸ªGTID ï¼‰ã€€ã€€</p>
<p class="a4">3.ä¸å…è®¸ä¸€ä¸ªSQLåŒæ—¶æ›´æ–°ä¸€ä¸ªäº‹åŠ¡å¼•æ“è¡¨å’Œéäº‹åŠ¡å¼•æ“è¡¨</p>
<p class="a4">4.åœ¨ä¸€ä¸ªå¤åˆ¶ç»„ä¸­ï¼Œå¿…é¡»è¦æ±‚ç»Ÿä¸€å¼€å¯GTIDæˆ–è€…æ˜¯å…³é—­GTID</p>
<p class="a4">5.å¼€å¯GTIDéœ€è¦é‡å¯ï¼ˆ5.7é™¤å¤–ï¼‰</p>
<p class="a4">6.å¼€å¯GTIDåï¼Œå°±ä¸å†ä½¿ç”¨åŸæ¥çš„ä¼ ç»Ÿå¤åˆ¶æ–¹å¼</p>
<p class="a4">7.å¯¹äºcreate temporary table å’Œ drop temporary tableè¯­å¥ä¸æ”¯æŒ</p>
<p class="a4">8.ä¸æ”¯æŒsql_slave_skip_counter</p>
</blockquote>
</div>
<h3>1.3.4 COM_BINLOG_DUMP_GTID</h3>
<p>ä»æœºå‘é€åˆ°ä¸»æœºæ‰§è¡Œçš„äº‹åŠ¡çš„æ ‡è¯†ç¬¦çš„ä¸»èŒƒå›´</p>
<p>ã€€ã€€&nbsp;<span class="cnblogs_code">Master send all other transactions to slave</span>&nbsp;</p>
<p>ã€€ã€€åŒæ ·çš„GTIDä¸èƒ½è¢«æ‰§è¡Œä¸¤æ¬¡ï¼Œå¦‚æœæœ‰åŒæ ·çš„GTIDï¼Œä¼šè‡ªåŠ¨è¢«skipæ‰ã€‚</p>
<p align="center"><img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230172535945-1927730298.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" />&nbsp;</p>

<p>ã€€ã€€slave1ï¼šå°†è‡ªå·±çš„UUID1ï¼š1å‘é€ç»™masterï¼Œç„¶åæ¥æ”¶åˆ°äº†UUID1ï¼š2ï¼ŒUUID1ï¼š3 event</p>
<p>ã€€ã€€slave2ï¼šå°†è‡ªå·±çš„UUID1ï¼š1ï¼ŒUUID1ï¼š2å‘é€ç»™masterï¼Œç„¶åæ¥æ”¶åˆ°äº†UUID1ï¼š3äº‹ä»¶</p>
<p><span style="background-color: #00ff00;"><strong>GTID</strong><strong>ç»„æˆ</strong></span></p>
<p>ã€€ã€€GTIDå®é™…ä¸Šæ˜¯ç”±UUID+TIDç»„æˆçš„ã€‚å…¶ä¸­UUIDæ˜¯ä¸€ä¸ªMySQLå®ä¾‹çš„å”¯ä¸€æ ‡è¯†ã€‚TIDä»£è¡¨äº†è¯¥å®ä¾‹ä¸Šå·²ç»æäº¤çš„äº‹åŠ¡æ•°é‡ï¼Œå¹¶ä¸”éšç€äº‹åŠ¡æäº¤å•è°ƒé€’å¢</p>
<div>
<div class="cnblogs_code">
<pre>GTID =<span style="color: #000000;"> source_id ï¼štransaction_id
7E11FA47</span>-31CA-19E1-9E56-C43AA21293967:<span style="color: #800080;">29</span></pre>
</div>
</div>
<h3>1.3.5 ã€ç¤ºä¾‹äºŒã€‘MySQL GTIDå¤åˆ¶é…ç½®</h3>
<p>ä¸»èŠ‚ç‚¹my.cnfæ–‡ä»¶</p>
<div>
<div class="cnblogs_code">
<pre># <span style="color: #0000ff;">vi</span> /etc/<span style="color: #000000;">my.cnf
[mysqld]
basedir</span>=/usr/local/<span style="color: #000000;">mysql
datadir</span>=/data/<span style="color: #000000;">mysql
server</span>-<span style="color: #0000ff;">id</span>=<span style="color: #800080;">1</span><span style="color: #000000;">
log</span>-bin=mysql-<span style="color: #000000;">bin
socket</span>=/tmp/<span style="color: #000000;">mysql.sock
binlog</span>-format=<span style="color: #000000;">ROW
gtid</span>-mode=<span style="color: #000000;">on
enforce</span>-gtid-consistency=<span style="color: #0000ff;">true</span><span style="color: #000000;">
log</span>-slave-updates=<span style="color: #800080;">1</span></pre>
</div>
</div>
<p>ä»èŠ‚ç‚¹my.cnfæ–‡ä»¶</p>
<div>
<div class="cnblogs_code">
<pre># <span style="color: #0000ff;">vi</span> /etc/<span style="color: #000000;">my.cnf
[mysqld]
basedir</span>=/usr/local/<span style="color: #000000;">mysql
datadir</span>=/data/<span style="color: #000000;">mysql
server</span>-<span style="color: #0000ff;">id</span>=<span style="color: #800080;">2</span><span style="color: #000000;">
binlog</span>-format=<span style="color: #000000;">ROW
gtid</span>-mode=<span style="color: #000000;">on
enforce</span>-gtid-consistency=<span style="color: #0000ff;">true</span><span style="color: #000000;">
log</span>-bin=mysql-<span style="color: #000000;">bin
log_slave_updates </span>= <span style="color: #800080;">1</span><span style="color: #000000;">
socket</span>=/tmp/mysql.sock</pre>
</div>
</div>
<p><strong>é…ç½®æ–‡ä»¶æ³¨è§£</strong></p>
<div>
<div class="cnblogs_code">
<pre>server-<span style="color: #0000ff;">id</span>=<span style="color: #000000;">x                    # åŒä¸€ä¸ªå¤åˆ¶æ‹“æ‰‘ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨çš„idå·å¿…é¡»æƒŸä¸€
binlog</span>-format=<span style="color: #000000;">RO               # äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼Œå¼ºçƒˆå»ºè®®ä¸ºROW
gtid</span>-mode=<span style="color: #000000;">on                   # å¯ç”¨gtidç±»å‹ï¼Œå¦åˆ™å°±æ˜¯æ™®é€šçš„å¤åˆ¶æ¶æ„
enforce</span>-gtid-consistency=<span style="color: #0000ff;">true</span><span style="color: #000000;">  # å¼ºåˆ¶GTIDçš„ä¸€è‡´æ€§
log</span>-slave-updates=<span style="color: #800080;">1</span>            # slaveæ›´æ–°æ˜¯å¦è®°å…¥æ—¥å¿—</pre>
</div>
</div>
<p>ã€€ã€€å¤åˆ¶ç”¨æˆ·å‡†å¤‡ï¼ˆMasterä¸»èŠ‚ç‚¹ï¼‰</p>
<div>
<div class="cnblogs_code">
<pre>mysql>GRANT REPLICATION SLAVE ON *.* TO <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7b091e0b3b">[email&#160;protected]</a><span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.%</span><span style="color: #800000;">'</span> IDENTIFIED BY <span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span>;</pre>
</div>
<p>ã€€ã€€å¼€å¯å¤åˆ¶ï¼ˆSlaveä»èŠ‚ç‚¹ï¼‰</p>
</div>
<div>
<div class="cnblogs_code">
<pre>mysql><span style="color: #000000;">start slave;
mysql</span>>show slave status\G</pre>
</div>
<p>ã€€ã€€ç°åœ¨å°±å¯ä»¥è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•ã€‚</p>
</div>
<h2>1.4 éƒ¨ç½²MHA</h2>
<p>ã€€ã€€æœ¬æ¬¡MHAçš„éƒ¨ç½²åŸºäºGTIDå¤åˆ¶æˆåŠŸæ„å»ºï¼Œæ™®é€šä¸»ä»å¤åˆ¶ä¹Ÿå¯ä»¥æ„å»ºMHAæ¶æ„ã€‚</p>
<h3>1.4.1 ç¯å¢ƒå‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹æ“ä½œï¼‰</h3>
<p><strong>å®‰è£…ä¾èµ–åŒ…</strong></p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> <span style="color: #0000ff;">perl</span>-DBD-MySQL -y</pre>
</div>
<p>ã€€ã€€&nbsp; ä¸‹è½½mhaè½¯ä»¶ï¼Œmhaå®˜ç½‘ï¼š<a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://code.google.com/archive/p/mysql-master-ha/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://code.google.com/archive/p/mysql-master-ha/'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://code.google.com/archive/p/mysql-master-ha/"  target="_blank">https://code.google.com/archive/p/mysql-master-ha/</a></p>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; githubä¸‹è½½åœ°å€ï¼š<a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/yoshinorim/mha4mysql-manager/wiki/Downloads  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/yoshinorim/mha4mysql-manager/wiki/Downloads'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/yoshinorim/mha4mysql-manager/wiki/Downloads"  target="_blank">https://github.com/yoshinorim/mha4mysql-manager/wiki/Downloads</a></p>
<p><span style="text-decoration: underline;"><strong><em>ä¸‹è½½è½¯ä»¶åŒ…</em></strong></span></p>
<div>
<blockquote>
<p class="ad">mha4mysql-manager-0.56-0.el6.noarch.rpm</p>
<p class="ad">mha4mysql-manager-0.56.tar.gz</p>
<p class="ad">mha4mysql-node-0.56-0.el6.noarch.rpm</p>
<p class="ad">mha4mysql-node-0.56.tar.gz</p>
</blockquote>
</div>
<p><em><span style="text-decoration: underline;"><strong>åœ¨æ‰€æœ‰èŠ‚ç‚¹å®‰è£…node</strong></span></em></p>
<div>
<div class="cnblogs_code">
<pre>rpm -ivh mha4mysql-node-<span style="color: #800080;">0.56</span>-<span style="color: #800080;">0</span>.el6.noarch.rpm</pre>
</div>
</div>
<p>åˆ›å»ºmhaç®¡ç†ç”¨æˆ·</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">grant</span> <span style="color: #808080;">all</span> <span style="color: #0000ff;">privileges</span> <span style="color: #0000ff;">on</span> <span style="color: #808080;">*</span>.<span style="color: #808080;">*</span> <span style="color: #0000ff;">to</span> <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="402d282100">[email&#160;protected]</a><span style="color: #ff0000;">'</span><span style="color: #ff0000;">10.0.0.%</span><span style="color: #ff0000;">'</span> identified <span style="color: #0000ff;">by</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">mha</span><span style="color: #ff0000;">'</span>;</pre>
</div>
<p class="ad"># ä¸»åº“ä¸Šåˆ›å»ºï¼Œä»åº“ä¼šè‡ªåŠ¨å¤åˆ¶ï¼ˆåœ¨ä»åº“ä¸ŠæŸ¥çœ‹ï¼‰</p>
</div>
<p>ã€€ã€€åˆ›å»ºå‘½ä»¤è½¯è¿æ¥<span style="color: #ff0000;"><strong>ï¼ˆé‡è¦ï¼‰</strong></span></p>
<div>
<p class="ad">ã€€ã€€å¦‚æœä¸åˆ›å»ºå‘½ä»¤è½¯è¿æ¥ï¼Œæ£€æµ‹mhaå¤åˆ¶æƒ…å†µçš„æ—¶å€™ä¼šæŠ¥é”™</p>
<div class="cnblogs_code">
<pre>ln <span style="color: #808080;">-</span>s <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>bin<span style="color: #808080;">/</span>mysqlbinlog <span style="color: #808080;">/</span>usr<span style="color: #808080;">/</span>bin<span style="color: #808080;">/</span><span style="color: #000000;">mysqlbinlog
ln </span><span style="color: #808080;">-</span>s <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>bin<span style="color: #808080;">/</span>mysql <span style="color: #808080;">/</span>usr<span style="color: #808080;">/</span>bin<span style="color: #808080;">/</span>mysql</pre>
</div>
</div>
<h3>1.4.2 éƒ¨ç½²ç®¡ç†èŠ‚ç‚¹ï¼ˆmha-managerï¼‰</h3>
<p>åœ¨mysql-db03ä¸Šéƒ¨ç½²ç®¡ç†èŠ‚ç‚¹</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> å®‰è£…epelæºï¼Œè½¯ä»¶éœ€è¦</span>
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6<span style="color: #000000;">.repo 
</span><span style="color: #008000;">#</span><span style="color: #008000;"> å®‰è£…manager ä¾èµ–åŒ…</span>
yum install -y perl-Config-Tiny epel-release perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-<span style="color: #000000;">HiRes
</span><span style="color: #008000;">#</span><span style="color: #008000;"> å®‰è£…managerç®¡ç†è½¯ä»¶</span>
rpm -ivh mha4mysql-manager-0.56-0.el6.noarch.rpm</pre>
</div>
</div>
<p><strong>åˆ›å»ºå¿…é¡»ç›®å½•</strong></p>
<div>
<div class="cnblogs_code">
<pre>mkdir -p /etc/<span style="color: #000000;">mha
mkdir </span>-p /var/log/mha/app1    ----ã€‹å¯ä»¥ç®¡ç†å¤šå¥—ä¸»ä»å¤åˆ¶</pre>
</div>
</div>
<p><strong><em>ç¼–è¾‘mha-manager</em></strong><strong><em>é…ç½®æ–‡ä»¶</em></strong></p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e89a87879ca88c8ad8db">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat  /etc/mha/app1.cnf</span>
<span style="color: #000000;">[server default]                        
manager_log</span>=/var/log/mha/app1/<span style="color: #000000;">manager
manager_workdir</span>=/var/log/mha/<span style="color: #000000;">app1
master_binlog_dir</span>=/data/<span style="color: #000000;">mysql
user</span>=<span style="color: #000000;">mha
password</span>=<span style="color: #000000;">mha
ping_interval</span>=2<span style="color: #000000;">
repl_password</span>=123<span style="color: #000000;">
repl_user</span>=<span style="color: #000000;">repl
ssh_user</span>=<span style="color: #000000;">root

[server1]
hostname</span>=10.0.0.51<span style="color: #000000;">
port</span>=3306<span style="color: #000000;">

[server2]
hostname</span>=10.0.0.52<span style="color: #000000;">
port</span>=3306<span style="color: #000000;">

[server3]
hostname</span>=10.0.0.53<span style="color: #000000;">
port</span>=3306</pre>
</div>
</div>
<p><strong>ã€é…ç½®æ–‡ä»¶è¯¦è§£ã€‘</strong></p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('ace8f99a-1a22-46a9-ae00-1f069cc0f0a0')"><img id="code_img_closed_ace8f99a-1a22-46a9-ae00-1f069cc0f0a0" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_ace8f99a-1a22-46a9-ae00-1f069cc0f0a0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ace8f99a-1a22-46a9-ae00-1f069cc0f0a0',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_ace8f99a-1a22-46a9-ae00-1f069cc0f0a0" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">[server default]
</span><span style="color: #008080;"> 2</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®managerçš„å·¥ä½œç›®å½•</span>
<span style="color: #008080;"> 3</span> manager_workdir=/var/log/masterha/<span style="color: #000000;">app1
</span><span style="color: #008080;"> 4</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®managerçš„æ—¥å¿—</span>
<span style="color: #008080;"> 5</span> manager_log=/var/log/masterha/app1/<span style="color: #000000;">manager.log 
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®master ä¿å­˜binlogçš„ä½ç½®ï¼Œä»¥ä¾¿MHAå¯ä»¥æ‰¾åˆ°masterçš„æ—¥å¿—ï¼Œæˆ‘è¿™é‡Œçš„ä¹Ÿå°±æ˜¯mysqlçš„æ•°æ®ç›®å½•</span>
<span style="color: #008080;"> 7</span> master_binlog_dir=/data/<span style="color: #000000;">mysql
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®è‡ªåŠ¨failoveræ—¶å€™çš„åˆ‡æ¢è„šæœ¬</span>
<span style="color: #008080;"> 9</span> master_ip_failover_script= /usr/local/bin/<span style="color: #000000;">master_ip_failover
</span><span style="color: #008080;">10</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®æ‰‹åŠ¨åˆ‡æ¢æ—¶å€™çš„åˆ‡æ¢è„šæœ¬</span>
<span style="color: #008080;">11</span> master_ip_online_change_script= /usr/local/bin/<span style="color: #000000;">master_ip_online_change
</span><span style="color: #008080;">12</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®mysqlä¸­rootç”¨æˆ·çš„å¯†ç ï¼Œè¿™ä¸ªå¯†ç æ˜¯å‰æ–‡ä¸­åˆ›å»ºç›‘æ§ç”¨æˆ·çš„é‚£ä¸ªå¯†ç </span>
<span style="color: #008080;">13</span> password=123456
<span style="color: #008080;">14</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®ç›‘æ§ç”¨æˆ·root</span>
<span style="color: #008080;">15</span> user=<span style="color: #000000;">root
</span><span style="color: #008080;">16</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®ç›‘æ§ä¸»åº“ï¼Œå‘é€pingåŒ…çš„æ—¶é—´é—´éš”ï¼Œå°è¯•ä¸‰æ¬¡æ²¡æœ‰å›åº”çš„æ—¶å€™è‡ªåŠ¨è¿›è¡Œfailover</span>
<span style="color: #008080;">17</span> ping_interval=1
<span style="color: #008080;">18</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®è¿œç«¯mysqlåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶binlogçš„ä¿å­˜ä½ç½®</span>
<span style="color: #008080;">19</span> remote_workdir=/<span style="color: #000000;">tmp
</span><span style="color: #008080;">20</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®å¤åˆ¶ç”¨æˆ·çš„å¯†ç </span>
<span style="color: #008080;">21</span> repl_password=123456
<span style="color: #008080;">22</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®å¤åˆ¶ç¯å¢ƒä¸­çš„å¤åˆ¶ç”¨æˆ·å </span>
<span style="color: #008080;">23</span> repl_user=<span style="color: #000000;">rep
</span><span style="color: #008080;">24</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®å‘ç”Ÿåˆ‡æ¢åå‘é€çš„æŠ¥è­¦çš„è„šæœ¬</span>
<span style="color: #008080;">25</span> report_script=/usr/local/<span style="color: #000000;">send_report
</span><span style="color: #008080;">26</span> <span style="color: #008000;">#</span><span style="color: #008000;">ä¸€æ—¦MHAåˆ°server02çš„ç›‘æ§ä¹‹é—´å‡ºç°é—®é¢˜ï¼ŒMHA Managerå°†ä¼šå°è¯•ä»server03ç™»å½•åˆ°server02</span>
<span style="color: #008080;">27</span> secondary_check_script= /usr/local/bin/masterha_secondary_check -s server03 -s server02 --user=root --master_host=server02 --master_ip=10.0.0.51 --master_port=3306
<span style="color: #008080;">28</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®æ•…éšœå‘ç”Ÿåå…³é—­æ•…éšœä¸»æœºè„šæœ¬ï¼ˆè¯¥è„šæœ¬çš„ä¸»è¦ä½œç”¨æ˜¯å…³é—­ä¸»æœºæ”¾åœ¨å‘ç”Ÿè„‘è£‚,è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ï¼‰</span>
<span style="color: #008080;">29</span> shutdown_script=<span style="color: #800000;">""</span>
<span style="color: #008080;">30</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®sshçš„ç™»å½•ç”¨æˆ·å</span>
<span style="color: #008080;">31</span> ssh_user=<span style="color: #000000;">root 
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span> <span style="color: #000000;">[server1]
</span><span style="color: #008080;">34</span> hostname=10.0.0.51
<span style="color: #008080;">35</span> port=3306
<span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> <span style="color: #000000;">[server2]
</span><span style="color: #008080;">38</span> hostname=10.0.0.52
<span style="color: #008080;">39</span> port=3306
<span style="color: #008080;">40</span> <span style="color: #008000;">#</span><span style="color: #008000;">è®¾ç½®ä¸ºå€™é€‰masterï¼Œå¦‚æœè®¾ç½®è¯¥å‚æ•°ä»¥åï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢ä»¥åå°†ä¼šå°†æ­¤ä»åº“æå‡ä¸ºä¸»åº“ï¼Œå³ä½¿è¿™ä¸ªä¸»åº“ä¸æ˜¯é›†ç¾¤ä¸­äº‹ä»¶æœ€æ–°çš„slave</span>
<span style="color: #008080;">41</span> candidate_master=1
<span style="color: #008080;">42</span> <span style="color: #008000;">#</span><span style="color: #008000;">é»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸€ä¸ªslaveè½åmaster 100Mçš„relay logsçš„è¯ï¼ŒMHAå°†ä¸ä¼šé€‰æ‹©è¯¥slaveä½œä¸ºä¸€ä¸ªæ–°çš„masterï¼Œå› ä¸ºå¯¹äºè¿™ä¸ªslaveçš„æ¢å¤éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œé€šè¿‡è®¾ç½®check_repl_delay=0,MHAè§¦å‘åˆ‡æ¢åœ¨é€‰æ‹©ä¸€ä¸ªæ–°çš„masterçš„æ—¶å€™å°†ä¼šå¿½ç•¥å¤åˆ¶å»¶æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºè®¾ç½®äº†candidate_master=1çš„ä¸»æœºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™ä¸ªå€™é€‰ä¸»åœ¨åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ä¸€å®šæ˜¯æ–°çš„master</span>
<span style="color: #008080;">43</span> check_repl_delay=0</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code é…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜</span></div>
</div>
<p><strong>é…ç½®sshä¿¡ä»»(å¯†é’¥åˆ†å‘ï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œ)</strong></p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> ç”Ÿæˆå¯†é’¥</span>
ssh-keygen -t dsa -P <span style="color: #800000;">''</span> -f ~/.ssh/id_dsa >/dev/null 2>&1
<span style="color: #008000;">#</span><span style="color: #008000;"> åˆ†å‘å…¬é’¥ï¼ŒåŒ…æ‹¬è‡ªå·±</span>
<span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> 1 2 3 ;do ssh-copy-id -i /root/.ssh/id_dsa.pub <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7a0815150e3a4b4a544a544a544f">[email&#160;protected]</a>$i ;done</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; åˆ†å‘å®Œæˆåæµ‹è¯•åˆ†å‘æ˜¯å¦æˆåŠŸ</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> 1 2 3 ;do ssh 10.0.0.5<span style="color: #000000;">$i  date ;done
æˆ–
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a4d6cbcbd0e4c0c69497">[email&#160;protected]</a> </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_ssh --conf=/etc/mha/app1.cnf</span>
<span style="color: #000000;">æœ€åä¸€è¡Œä¿¡æ¯ä¸ºå¦‚ä¸‹å­—æ ·å³ä¸ºåˆ†å‘æˆåŠŸï¼š
Thu Dec </span>28 18:44:53 2017 - [info] All SSH connection tests passed successfully.</pre>
</div>
</div>
<h3>1.4.3 å¯åŠ¨mha</h3>
<p>ç»è¿‡ä¸Šé¢çš„éƒ¨ç½²è¿‡åï¼Œmhaæ¶æ„å·²ç»æ­å»ºå®Œæˆ</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> å¯åŠ¨mha</span>
nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover < /dev/null > /var/log/mha/app1/manager.log 2>&1 &</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å¯åŠ¨æˆåŠŸåï¼Œæ£€æŸ¥ä¸»åº“çŠ¶æ€</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bfcdd0d0cbffdbdd8f8c">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_status --conf=/etc/mha/app1.cnf </span>
app1 (pid:3298) <span style="color: #0000ff;">is</span> running(0:PING_OK), master:10.0.0.51</pre>
</div>
</div>
<h3>1.4.4 åˆ‡æ¢masteræµ‹è¯•</h3>
<p>æŸ¥çœ‹ç°åœ¨çš„ä¸»åº“æ˜¯å“ªä¸ª</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e89a87879ca88c8ad8db">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_status --conf=/etc/mha/app1.cnf </span>
app1 (pid:11669) <span style="color: #0000ff;">is</span> running(0:PING_OK), master:10.0.0.51</pre>
</div>
</div>
<p>æ‰‹åŠ¨åœæ­¢ä¸»åº“</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0c7e6363784c686e3c3d">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/mysqld stop </span>
Shutting down MySQL..... SUCCESS!</pre>
</div>
</div>
<p>å†åœæ­¢æ•°æ®çš„åŒæ—¶æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯çš„å˜åŒ–</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="592b36362d193d3b696a">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> tailf /var/log/mha/app1/manager</span>
~~~<span style="color: #000000;">
Fri Dec </span>29 15:51:14 2017 - [info]  All other slaves should start replication <span style="color: #0000ff;">from</span><span style="color: #000000;">
here. Statement should be: CHANGE MASTER TO MASTER_HOST</span>=<span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.52</span><span style="color: #800000;">'</span>, MASTER_PORT=3306, MASTER_AUTO_POSITION=1, MASTER_USER=<span style="color: #800000;">'</span><span style="color: #800000;">repl</span><span style="color: #800000;">'</span>, MASTER_PASSWORD=<span style="color: #800000;">'</span><span style="color: #800000;">xxx</span><span style="color: #800000;">'</span>;</pre>
</div>
</div>
<p><span style="background-color: #ffff00;"><strong>ä¿®å¤ä¸»ä»</strong></span></p>
<p>â‘ &nbsp; å¯åŠ¨åŸä¸»åº“,æ·»åŠ change master to ä¿¡æ¯</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="55273a3a211531376564">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/mysqld start </span>
<span style="color: #000000;">Starting MySQL. SUCCESS!
mysql</span>> CHANGE MASTER TO MASTER_HOST=<span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.52</span><span style="color: #800000;">'</span>, MASTER_PORT=3306, MASTER_AUTO_POSITION=1, MASTER_USER=<span style="color: #800000;">'</span><span style="color: #800000;">repl</span><span style="color: #800000;">'</span>, MASTER_PASSWORD=<span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span><span style="color: #000000;">;
mysql</span>> start slave;</pre>
</div>
</div>
<p>â‘¡&nbsp; æŸ¥çœ‹ä¸»ä»å¤åˆ¶çŠ¶æ€</p>
<div>
<div class="cnblogs_code">
<pre>mysql><span style="color: #000000;"> show slave status\G
                   Master_Host: </span>10.0.0.52<span style="color: #000000;">
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes</span></pre>
</div>
</div>
<p><span style="background-color: #ffff00;"><strong>ä¿®å¤mha</strong></span></p>
<p>â‘ &nbsp; ä¿®æ”¹app1.cnfé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å›è¢«å‰”é™¤ä¸»æœº</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bdcfd2d2c9fdd9df8d8e">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat  /etc/mha/app1.cnf </span>
<span style="color: #000000;">[binlog1]
hostname</span>=10.0.0.53<span style="color: #000000;">
master_binlog_dir</span>=/data/mysql/binlog/<span style="color: #000000;">
no_master</span>=1<span style="color: #000000;">

[server default]
manager_log</span>=/var/log/mha/app1/<span style="color: #000000;">manager
manager_workdir</span>=/var/log/mha/<span style="color: #000000;">app1
master_binlog_dir</span>=/data/<span style="color: #000000;">mysql
master_ip_failover_script</span>=/usr/local/bin/<span style="color: #000000;">master_ip_failover
password</span>=<span style="color: #000000;">mha
ping_interval</span>=2<span style="color: #000000;">
repl_password</span>=123<span style="color: #000000;">
repl_user</span>=<span style="color: #000000;">repl
ssh_user</span>=<span style="color: #000000;">root
user</span>=<span style="color: #000000;">mha

[server1]
hostname</span>=10.0.0.51<span style="color: #000000;">
port</span>=3306<span style="color: #000000;">

[server2]
hostname</span>=10.0.0.52<span style="color: #000000;">
port</span>=3306<span style="color: #000000;">

[server3]
hostname</span>=10.0.0.53<span style="color: #000000;">
port</span>=3306</pre>
</div>
</div>
<p>â‘¡&nbsp; mhaæ£€æŸ¥å¤åˆ¶çŠ¶æ€</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c4b6ababb084a0a6f4f7">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_repl --conf=/etc/mha/app1.cnf</span>
MySQL Replication Health <span style="color: #0000ff;">is</span> OK.</pre>
</div>
</div>
<p>â‘¢&nbsp; å¯åŠ¨mhaç¨‹åº</p>
<div>
<div class="cnblogs_code">
<pre>nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover < /dev/null > /var/log/mha/app1/manager.log 2>&1 &</pre>
</div>
</div>
<p><span style="background-color: #ffff00;"><strong>åˆ°æ­¤ä¸»åº“åˆ‡æ¢æˆåŠŸ</strong></span></p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ea9885859eaa8e88dad9">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_status --conf=/etc/mha/app1.cnf </span>
app1 (pid:11978) <span style="color: #0000ff;">is</span> running(0:PING_OK), master:10.0.0.52</pre>
</div>
</div>
<p><span style="background-color: #00ff00;"><strong>å®éªŒç»“æŸå°†ä¸»åº“åˆ‡æ¢å›db01.</strong></span></p>
<p>â‘ &nbsp; åœæ­¢mha</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0e7c61617a4e6a6c3e3d">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_stop --conf=/etc/mha/app1.cnf </span>
Stopped app1 successfully.</pre>
</div>
</div>
<p>â‘¡&nbsp; åœæ­¢æ‰€æœ‰ä»åº“slave(æ‰€æœ‰åº“æ“ä½œ)</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">stop slave;
reset slave all;</span></pre>
</div>
</div>
<p>â‘¢&nbsp; é‡åšä¸»ä»å¤åˆ¶(db02ã€db03)</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">CHANGE MASTER TO 
ã€€ã€€MASTER_HOST</span>=<span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.51</span><span style="color: #800000;">'</span><span style="color: #000000;">, 
ã€€ã€€MASTER_PORT</span>=3306<span style="color: #000000;">, 
ã€€ã€€MASTER_AUTO_POSITION</span>=1<span style="color: #000000;">, 
ã€€ã€€MASTER_USER</span>=<span style="color: #800000;">'</span><span style="color: #800000;">repl</span><span style="color: #800000;">'</span><span style="color: #000000;">, 
ã€€ã€€MASTER_PASSWORD</span>=<span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span>;</pre>
</div>
<p>â‘£&nbsp; å¯åŠ¨slave</p>
<div>
<div class="cnblogs_code">
<pre>start slave;</pre>
</div>
<p class="ad">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; å¯åŠ¨ä¹‹åæ£€æŸ¥ä»åº“æ˜¯å¦ä¸ºä¸¤ä¸ªyes&nbsp;&nbsp;<span class="cnblogs_code">show slave status\G</span>&nbsp;</p>
</div>
<p>â‘¤&nbsp; mhaæ£€æŸ¥ä¸»ä»å¤åˆ¶</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f0829f9f84b09492c0c3">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_repl --conf=/etc/mha/app1.cnf</span>
MySQL Replication Health <span style="color: #0000ff;">is</span> OK.</pre>
</div>
</div>
<p>â‘¥&nbsp; å¯åŠ¨mha</p>
<div>
<div class="cnblogs_code">
<pre>nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover < /dev/null > /var/log/mha/app1/manager.log 2>&1 &</pre>
</div>
<p class="ad">ã€€ã€€æ£€æŸ¥åˆ‡æ¢æ˜¯å¦æˆåŠŸ</p>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="26544949526642441615">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> masterha_check_status --conf=/etc/mha/app1.cnf</span>
app1 (pid:12127) <span style="color: #0000ff;">is</span> running(0:PING_OK), master:10.0.0.51</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; åˆ°æ­¤ä¸»ä¸»èŠ‚ç‚¹æœ‰åˆ‡å›åˆ°db01</p>
<h3>1.4.5 è®¾ç½®æƒé‡</h3>
<p>ä¿®æ”¹[server1]çš„æƒé‡</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[server1]
hostname</span>=10.0.0.51<span style="color: #000000;">
port</span>=3306<span style="color: #000000;">
candidate_master</span>=1<span style="color: #000000;">
check_repl_delay</span>=0</pre>
</div>
</div>
<p>é…ç½®è¯´æ˜</p>
<div class="cnblogs_code">
<pre>candidate_master=1                  ----<span style="color: #000000;">ã€‹ä¸ç®¡æ€æ ·éƒ½åˆ‡åˆ°ä¼˜å…ˆçº§é«˜çš„ä¸»æœºï¼Œä¸€èˆ¬åœ¨ä¸»æœºæ€§èƒ½å·®å¼‚çš„æ—¶å€™ç”¨           
check_repl_delay</span>=0                  ----ã€‹ä¸ç®¡ä¼˜å…ˆçº§é«˜çš„å¤‡é€‰åº“ï¼Œæ•°æ®å»¶æ—¶å¤šä¹…éƒ½è¦å¾€é‚£åˆ‡</pre>
</div>
<p><span style="background-color: #00ff00; color: #ff0000;"><strong>æ³¨ï¼š </strong></span></p>
<blockquote>
<p style="color: #000000;">1ã€å¤šåœ°å¤šä¸­å¿ƒï¼Œè®¾ç½®æœ¬åœ°èŠ‚ç‚¹ä¸ºé«˜æƒé‡</p>
<p style="color: #000000;">2ã€åœ¨æœ‰åŠåŒæ­¥å¤åˆ¶çš„ç¯å¢ƒä¸­ï¼Œè®¾ç½®åŠåŒæ­¥å¤åˆ¶èŠ‚ç‚¹ä¸ºé«˜æƒé‡</p>
<p style="color: #000000;">3ã€ä½ è§‰ç€å“ªä¸ªæœºå™¨é€‚åˆåšä¸»èŠ‚ç‚¹ï¼Œé…ç½®è¾ƒé«˜çš„ ã€æ€§èƒ½è¾ƒå¥½çš„</p>
</blockquote>
<h2>1.5 é…ç½®VIPæ¼‚ç§»</h2>
<h3>1.5.1 IPæ¼‚ç§»çš„ä¸¤ç§æ–¹å¼</h3>
<p>&nbsp;ã€€ã€€? é€šè¿‡keepalivedçš„æ–¹å¼ï¼Œç®¡ç†è™šæ‹ŸIPçš„æ¼‚ç§»</p>
<p>ã€€ã€€&nbsp;?&nbsp;&nbsp;é€šè¿‡MHAè‡ªå¸¦è„šæœ¬æ–¹å¼ï¼Œç®¡ç†è™šæ‹ŸIPçš„æ¼‚ç§»</p>
<h3>1.5.2 MHAè„šæœ¬æ–¹å¼</h3>
<p><span style="background-color: #00ff00;"><strong>ä¿®æ”¹mha</strong><strong>é…ç½®æ–‡ä»¶</strong></span></p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aedcc1c1daeecacc9e9d">[email&#160;protected]</a> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> grep "script" /etc/mha/app1.cnf </span>
<span style="color: #000000;">[server default]
master_ip_failover_script</span>=/usr/local/bin/master_ip_failover</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å†ä¸»é…ç½®ä¸­æ·»åŠ VIPè„šæœ¬</p>
<p><span style="background-color: #00ff00;"><strong>è„šæœ¬å†…å®¹</strong></span></p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('bac1ef9d-2c6b-4489-967d-8dd88e7087da')"><img id="code_img_closed_bac1ef9d-2c6b-4489-967d-8dd88e7087da" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_bac1ef9d-2c6b-4489-967d-8dd88e7087da" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bac1ef9d-2c6b-4489-967d-8dd88e7087da',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_bac1ef9d-2c6b-4489-967d-8dd88e7087da" class="cnblogs_code_hide">
<pre>[root<span style="color: #800080;">@db03</span> ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /usr/local/bin/master_ip_failover 
#!/usr/bin/env perl</span>
<span style="color: #0000ff;">use</span><span style="color: #000000;"> strict;
</span><span style="color: #0000ff;">use</span> warnings FATAL => <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">all</span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">use</span> Getopt::<span style="color: #000000;">Long;
</span><span style="color: #0000ff;">my</span><span style="color: #000000;"> (
    </span><span style="color: #800080;">$command</span>,          <span style="color: #800080;">$ssh_user</span>,        <span style="color: #800080;">$orig_master_host</span>, <span style="color: #800080;">$orig_master_ip</span>,
    <span style="color: #800080;">$orig_master_port</span>, <span style="color: #800080;">$new_master_host</span>, <span style="color: #800080;">$new_master_ip</span>,    <span style="color: #800080;">$new_master_port</span><span style="color: #000000;">
);
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$vip</span> = <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">10.0.0.55/24</span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$key</span> = <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">0</span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$ssh_start_vip</span> = <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">/sbin/ifconfig eth0:$key $vip</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$ssh_stop_vip</span> = <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">/sbin/ifconfig eth0:$key down</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;

GetOptions(
    </span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">command=s</span><span style="color: #000000; font-weight: bold;">'</span>          => \<span style="color: #800080;">$command</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">ssh_user=s</span><span style="color: #000000; font-weight: bold;">'</span>         => \<span style="color: #800080;">$ssh_user</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">orig_master_host=s</span><span style="color: #000000; font-weight: bold;">'</span> => \<span style="color: #800080;">$orig_master_host</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">orig_master_ip=s</span><span style="color: #000000; font-weight: bold;">'</span>   => \<span style="color: #800080;">$orig_master_ip</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">orig_master_port=i</span><span style="color: #000000; font-weight: bold;">'</span> => \<span style="color: #800080;">$orig_master_port</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">new_master_host=s</span><span style="color: #000000; font-weight: bold;">'</span>  => \<span style="color: #800080;">$new_master_host</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">new_master_ip=s</span><span style="color: #000000; font-weight: bold;">'</span>    => \<span style="color: #800080;">$new_master_ip</span>,
    <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">new_master_port=i</span><span style="color: #000000; font-weight: bold;">'</span>  => \<span style="color: #800080;">$new_master_port</span>,<span style="color: #000000;">
);

</span><span style="color: #0000ff;">exit</span> &<span style="color: #000000;">main();

</span><span style="color: #0000ff;">sub</span><span style="color: #000000;"> main {

    </span><span style="color: #0000ff;">print</span> <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">\n\nIN SCRIPT TEST====$ssh_stop_vip==$ssh_start_vip===\n\n</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;

    </span><span style="color: #0000ff;">if</span> ( <span style="color: #800080;">$command</span> eq <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">stop</span><span style="color: #000000; font-weight: bold;">"</span> || <span style="color: #800080;">$command</span> eq <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">stopssh</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;"> ) {

        </span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$exit_code</span> = <span style="color: #800000;">1</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">eval</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">print</span> <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">Disabling the VIP on old master: $orig_master_host \n</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
            </span>&<span style="color: #000000;">stop_vip();
            </span><span style="color: #800080;">$exit_code</span> = <span style="color: #800000;">0</span><span style="color: #000000;">;
        };
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7a5e3a">[email&#160;protected]</a>) {
            </span><span style="color: #0000ff;">warn</span> <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">Got Error: <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a084e0">[email&#160;protected]</a>\n</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">exit</span> <span style="color: #800080;">$exit_code</span><span style="color: #000000;">;
        }
        </span><span style="color: #0000ff;">exit</span> <span style="color: #800080;">$exit_code</span><span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">elsif</span> ( <span style="color: #800080;">$command</span> eq <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">start</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;"> ) {

        </span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$exit_code</span> = <span style="color: #800000;">10</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">eval</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">print</span> <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">Enabling the VIP - $vip on the new master - $new_master_host \n</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
            </span>&<span style="color: #000000;">start_vip();
            </span><span style="color: #800080;">$exit_code</span> = <span style="color: #800000;">0</span><span style="color: #000000;">;
        };
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e8cca8">[email&#160;protected]</a>) {
            </span><span style="color: #0000ff;">warn</span><span style="color: #000000;"> <a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ba9efa">[email&#160;protected]</a>;
            </span><span style="color: #0000ff;">exit</span> <span style="color: #800080;">$exit_code</span><span style="color: #000000;">;
        }
        </span><span style="color: #0000ff;">exit</span> <span style="color: #800080;">$exit_code</span><span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">elsif</span> ( <span style="color: #800080;">$command</span> eq <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">status</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;"> ) {
        </span><span style="color: #0000ff;">print</span> <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">Checking the Status of the script.. OK \n</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">exit</span> <span style="color: #800000;">0</span><span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
        </span>&<span style="color: #000000;">usage();
        </span><span style="color: #0000ff;">exit</span> <span style="color: #800000;">1</span><span style="color: #000000;">;
    }
}

</span><span style="color: #0000ff;">sub</span><span style="color: #000000;"> start_vip() {
    `ssh </span><span style="color: #800080;">$ssh_user</span>\@<span style="color: #800080;">$new_master_host</span> \<span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;"> $ssh_start_vip \"`;
}
sub stop_vip() {
     return 0  unless  ($ssh_user);
    `ssh $ssh_user\@$orig_master_host \" $ssh_stop_vip \"`;
}

sub usage {
    print
    </span><span style="color: #000000; font-weight: bold;">"</span>Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port\n<span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">;
}</span></pre>
</div>
<p><span class="cnblogs_code_collapse">View Code VIPç®¡ç†è„šæœ¬&nbsp;</span></div>
</div>
<p><em>ã€€ã€€è¯¥è„šæœ¬ä¸ºè½¯ä»¶è‡ªå¸¦ï¼Œè„šæœ¬è·å–æ–¹æ³•ï¼šå†mha</em><em>æºç åŒ…ä¸­çš„samples</em><em>ç›®å½•ä¸‹æœ‰è¯¥è„šæœ¬çš„æ¨¡æ¿ï¼Œå¯¹è¯¥æ¨¡æ¿è¿›è¡Œä¿®æ”¹å³å¯ä½¿ç”¨ã€‚è·¯å¾„å¦‚ï¼š&nbsp;<span class="cnblogs_code">mha4mysql-manager-<span style="color: #800000;">0.56</span>/samples/scripts</span>&nbsp;</em></p>
<p>ã€€ã€€è„šæœ¬ä¿®æ”¹å†…å®¹</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">my</span> <span style="color: #800080;">$vip</span> = <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">10.0.0.55/24</span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$key</span> = <span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000; font-weight: bold;">0</span><span style="color: #000000; font-weight: bold;">'</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$ssh_start_vip</span> = <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">/sbin/ifconfig eth0:$key $vip</span><span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">my</span> <span style="color: #800080;">$ssh_stop_vip</span> = <span style="color: #000000; font-weight: bold;">"</span><span style="color: #000000; font-weight: bold;">/sbin/ifconfig eth0:$key down</span><span style="color: #000000; font-weight: bold;">"</span>;</pre>
</div>
<p>è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™å¦åˆ™mhaæ— æ³•å¯åŠ¨</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">chmod</span> +x /usr/local/bin/master_ip_failover</pre>
</div>
</div>
<p><strong>æ‰‹åŠ¨ç»‘å®šVIP(</strong><strong>ä¸»åº“)</strong></p>
<div>
<div class="cnblogs_code">
<pre>ifconfig eth0:<span style="color: #800000;">0</span> <span style="color: #800000;">10.0</span>.<span style="color: #800000;">0.55</span>/<span style="color: #800000;">24</span></pre>
</div>
<p>ã€€ã€€æ£€æŸ¥</p>
</div>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e4968b8b90a48086d4d5">[email&#160;protected]</a> ~<span style="color: #000000;">]# ip a s eth0
</span><span style="color: #800080;">2</span>: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span style="color: #800080;">1500</span> qdisc pfifo_fast state UP qlen <span style="color: #800080;">1000</span><span style="color: #000000;">
    link</span>/ether <span style="color: #800080;">00</span>:0c:<span style="color: #800080;">29</span>:6c:7a:<span style="color: #800080;">11</span><span style="color: #000000;"> brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.51</span>/<span style="color: #800080;">24</span> brd <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.255</span><span style="color: #000000;"> scope global eth0
    inet </span><span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.55</span>/<span style="color: #800080;">24</span> brd <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.255</span> scope global secondary eth0:<span style="color: #800080;">0</span><span style="color: #000000;">
    inet6 fe80::20c:29ff:fe6c:7a11</span>/<span style="color: #800080;">64</span><span style="color: #000000;"> scope link 
       valid_lft forever preferred_lft forever</span></pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #ffffff;">&nbsp;&nbsp;&nbsp;<span style="background-color: #00ff00;"> <strong>è‡³æ­¤vip</strong><strong>æ¼‚ç§»é…ç½®å®Œæˆ&nbsp;</strong></span></span></p>
<h3>1.5.3 æµ‹è¯•è™šæ‹ŸIPæ¼‚ç§»</h3>
<p>æŸ¥çœ‹db02çš„slaveä¿¡æ¯</p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('9d5b6175-ebdf-4c5d-957f-65c2a0d693a4')"><img id="code_img_closed_9d5b6175-ebdf-4c5d-957f-65c2a0d693a4" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_9d5b6175-ebdf-4c5d-957f-65c2a0d693a4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9d5b6175-ebdf-4c5d-957f-65c2a0d693a4',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_9d5b6175-ebdf-4c5d-957f-65c2a0d693a4" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> mysql<span style="color: #808080;">></span><span style="color: #000000;"> show slave status\G
</span><span style="color: #008080;"> 2</span> <span style="color: #808080;">***************************</span> <span style="color: #800000; font-weight: bold;">1</span>. row <span style="color: #808080;">***************************</span>
<span style="color: #008080;"> 3</span>                Slave_IO_State: Waiting <span style="color: #0000ff;">for</span> master <span style="color: #0000ff;">to</span><span style="color: #000000;"> send event
</span><span style="color: #008080;"> 4</span>                   Master_Host: <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.51</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">                  Master_User: repl
</span><span style="color: #008080;"> 6</span>                   Master_Port: <span style="color: #800000; font-weight: bold;">3306</span>
<span style="color: #008080;"> 7</span>                 Connect_Retry: <span style="color: #800000; font-weight: bold;">60</span>
<span style="color: #008080;"> 8</span>               Master_Log_File: mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000007</span>
<span style="color: #008080;"> 9</span>           Read_Master_Log_Pos: <span style="color: #800000; font-weight: bold;">191</span>
<span style="color: #008080;">10</span>                Relay_Log_File: db02<span style="color: #808080;">-</span>relay<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000002</span>
<span style="color: #008080;">11</span>                 Relay_Log_Pos: <span style="color: #800000; font-weight: bold;">361</span>
<span style="color: #008080;">12</span>         Relay_Master_Log_File: mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000007</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">             Slave_IO_Running: Yes
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            Slave_SQL_Running: Yes
</span><span style="color: #008080;">15</span> <span style="color: #000000;">              Replicate_Do_DB: 
</span><span style="color: #008080;">16</span> <span style="color: #000000;">          Replicate_Ignore_DB: 
</span><span style="color: #008080;">17</span> <span style="color: #000000;">           Replicate_Do_Table: 
</span><span style="color: #008080;">18</span> <span style="color: #000000;">       Replicate_Ignore_Table: 
</span><span style="color: #008080;">19</span> <span style="color: #000000;">      Replicate_Wild_Do_Table: 
</span><span style="color: #008080;">20</span> <span style="color: #000000;">  Replicate_Wild_Ignore_Table: 
</span><span style="color: #008080;">21</span>                    Last_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">22</span> <span style="color: #000000;">                   Last_Error: 
</span><span style="color: #008080;">23</span>                  Skip_Counter: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">24</span>           Exec_Master_Log_Pos: <span style="color: #800000; font-weight: bold;">191</span>
<span style="color: #008080;">25</span>               Relay_Log_Space: <span style="color: #800000; font-weight: bold;">564</span>
<span style="color: #008080;">26</span> <span style="color: #000000;">              Until_Condition: None
</span><span style="color: #008080;">27</span> <span style="color: #000000;">               Until_Log_File: 
</span><span style="color: #008080;">28</span>                 Until_Log_Pos: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">29</span> <span style="color: #000000;">           Master_SSL_Allowed: No
</span><span style="color: #008080;">30</span> <span style="color: #000000;">           Master_SSL_CA_File: 
</span><span style="color: #008080;">31</span> <span style="color: #000000;">           Master_SSL_CA_Path: 
</span><span style="color: #008080;">32</span> <span style="color: #000000;">              Master_SSL_Cert: 
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            Master_SSL_Cipher: 
</span><span style="color: #008080;">34</span> <span style="color: #000000;">               Master_SSL_Key: 
</span><span style="color: #008080;">35</span>         Seconds_Behind_Master: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">36</span> <span style="color: #000000;">Master_SSL_Verify_Server_Cert: No
</span><span style="color: #008080;">37</span>                 Last_IO_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">38</span> <span style="color: #000000;">                Last_IO_Error: 
</span><span style="color: #008080;">39</span>                Last_SQL_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">40</span> <span style="color: #000000;">               Last_SQL_Error: 
</span><span style="color: #008080;">41</span> <span style="color: #000000;">  Replicate_Ignore_Server_Ids: 
</span><span style="color: #008080;">42</span>              Master_Server_Id: <span style="color: #800000; font-weight: bold;">51</span>
<span style="color: #008080;">43</span>                   Master_UUID: c8fcd56e<span style="color: #808080;">-</span>eb79<span style="color: #808080;">-</span>11e7<span style="color: #808080;">-</span>97b0<span style="color: #808080;">-</span><span style="color: #000000;">000c296c7a11
</span><span style="color: #008080;">44</span>              Master_Info_File: <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">5.6</span>.<span style="color: #800000; font-weight: bold;">36</span><span style="color: #808080;">/</span>data<span style="color: #808080;">/</span><span style="color: #000000;">master.info
</span><span style="color: #008080;">45</span>                     SQL_Delay: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">46</span>           SQL_Remaining_Delay: <span style="color: #0000ff;">NULL</span>
<span style="color: #008080;">47</span>       Slave_SQL_Running_State: Slave has <span style="color: #0000ff;">read</span> <span style="color: #808080;">all</span> relay <span style="color: #ff00ff;">log</span>; waiting <span style="color: #0000ff;">for</span> the slave I<span style="color: #808080;">/</span>O thread <span style="color: #0000ff;">to</span> <span style="color: #0000ff;">update</span><span style="color: #000000;"> it
</span><span style="color: #008080;">48</span>            Master_Retry_Count: <span style="color: #800000; font-weight: bold;">86400</span>
<span style="color: #008080;">49</span> <span style="color: #000000;">                  Master_Bind: 
</span><span style="color: #008080;">50</span> <span style="color: #000000;">      Last_IO_Error_Timestamp: 
</span><span style="color: #008080;">51</span> <span style="color: #000000;">     Last_SQL_Error_Timestamp: 
</span><span style="color: #008080;">52</span> <span style="color: #000000;">               Master_SSL_Crl: 
</span><span style="color: #008080;">53</span> <span style="color: #000000;">           Master_SSL_Crlpath: 
</span><span style="color: #008080;">54</span> <span style="color: #000000;">           Retrieved_Gtid_Set: 
</span><span style="color: #008080;">55</span>             Executed_Gtid_Set: c8fcd56e<span style="color: #808080;">-</span>eb79<span style="color: #808080;">-</span>11e7<span style="color: #808080;">-</span>97b0<span style="color: #808080;">-</span>000c296c7a11:<span style="color: #800000; font-weight: bold;">1</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">3</span>
<span style="color: #008080;">56</span>                 Auto_Position: <span style="color: #800000; font-weight: bold;">1</span>
<span style="color: #008080;">57</span> <span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code ç°åœ¨ä¸»ä»çŠ¶æ€</span></div>
<p>åœæ‰ä¸»åº“</p>
</div>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c6e7373685c787e2c2d">[email&#160;protected]</a> ~]# /etc/init.d/mysqld stop</pre>
</div>
</div>
<p>åœ¨db03ä¸ŠæŸ¥çœ‹ä»åº“slaveä¿¡æ¯</p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('55b33084-103e-4c89-bf41-2d29eb14a1ac')"><img id="code_img_closed_55b33084-103e-4c89-bf41-2d29eb14a1ac" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_55b33084-103e-4c89-bf41-2d29eb14a1ac" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('55b33084-103e-4c89-bf41-2d29eb14a1ac',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_55b33084-103e-4c89-bf41-2d29eb14a1ac" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> mysql<span style="color: #808080;">></span><span style="color: #000000;">  show slave status\G
</span><span style="color: #008080;"> 2</span> <span style="color: #808080;">***************************</span> <span style="color: #800000; font-weight: bold;">1</span>. row <span style="color: #808080;">***************************</span>
<span style="color: #008080;"> 3</span>                Slave_IO_State: Waiting <span style="color: #0000ff;">for</span> master <span style="color: #0000ff;">to</span><span style="color: #000000;"> send event
</span><span style="color: #008080;"> 4</span>                   Master_Host: <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.52</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">                  Master_User: repl
</span><span style="color: #008080;"> 6</span>                   Master_Port: <span style="color: #800000; font-weight: bold;">3306</span>
<span style="color: #008080;"> 7</span>                 Connect_Retry: <span style="color: #800000; font-weight: bold;">60</span>
<span style="color: #008080;"> 8</span>               Master_Log_File: mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000009</span>
<span style="color: #008080;"> 9</span>           Read_Master_Log_Pos: <span style="color: #800000; font-weight: bold;">191</span>
<span style="color: #008080;">10</span>                Relay_Log_File: db03<span style="color: #808080;">-</span>relay<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000002</span>
<span style="color: #008080;">11</span>                 Relay_Log_Pos: <span style="color: #800000; font-weight: bold;">361</span>
<span style="color: #008080;">12</span>         Relay_Master_Log_File: mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000009</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">             Slave_IO_Running: Yes
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            Slave_SQL_Running: Yes
</span><span style="color: #008080;">15</span> <span style="color: #000000;">              Replicate_Do_DB: 
</span><span style="color: #008080;">16</span> <span style="color: #000000;">          Replicate_Ignore_DB: 
</span><span style="color: #008080;">17</span> <span style="color: #000000;">           Replicate_Do_Table: 
</span><span style="color: #008080;">18</span> <span style="color: #000000;">       Replicate_Ignore_Table: 
</span><span style="color: #008080;">19</span> <span style="color: #000000;">      Replicate_Wild_Do_Table: 
</span><span style="color: #008080;">20</span> <span style="color: #000000;">  Replicate_Wild_Ignore_Table: 
</span><span style="color: #008080;">21</span>                    Last_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">22</span> <span style="color: #000000;">                   Last_Error: 
</span><span style="color: #008080;">23</span>                  Skip_Counter: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">24</span>           Exec_Master_Log_Pos: <span style="color: #800000; font-weight: bold;">191</span>
<span style="color: #008080;">25</span>               Relay_Log_Space: <span style="color: #800000; font-weight: bold;">564</span>
<span style="color: #008080;">26</span> <span style="color: #000000;">              Until_Condition: None
</span><span style="color: #008080;">27</span> <span style="color: #000000;">               Until_Log_File: 
</span><span style="color: #008080;">28</span>                 Until_Log_Pos: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">29</span> <span style="color: #000000;">           Master_SSL_Allowed: No
</span><span style="color: #008080;">30</span> <span style="color: #000000;">           Master_SSL_CA_File: 
</span><span style="color: #008080;">31</span> <span style="color: #000000;">           Master_SSL_CA_Path: 
</span><span style="color: #008080;">32</span> <span style="color: #000000;">              Master_SSL_Cert: 
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            Master_SSL_Cipher: 
</span><span style="color: #008080;">34</span> <span style="color: #000000;">               Master_SSL_Key: 
</span><span style="color: #008080;">35</span>         Seconds_Behind_Master: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">36</span> <span style="color: #000000;">Master_SSL_Verify_Server_Cert: No
</span><span style="color: #008080;">37</span>                 Last_IO_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">38</span> <span style="color: #000000;">                Last_IO_Error: 
</span><span style="color: #008080;">39</span>                Last_SQL_Errno: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">40</span> <span style="color: #000000;">               Last_SQL_Error: 
</span><span style="color: #008080;">41</span> <span style="color: #000000;">  Replicate_Ignore_Server_Ids: 
</span><span style="color: #008080;">42</span>              Master_Server_Id: <span style="color: #800000; font-weight: bold;">52</span>
<span style="color: #008080;">43</span>                   Master_UUID: c8fa1d13<span style="color: #808080;">-</span>eb79<span style="color: #808080;">-</span>11e7<span style="color: #808080;">-</span>97b0<span style="color: #808080;">-</span><span style="color: #000000;">000c29d60ab3
</span><span style="color: #008080;">44</span>              Master_Info_File: <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">5.6</span>.<span style="color: #800000; font-weight: bold;">36</span><span style="color: #808080;">/</span>data<span style="color: #808080;">/</span><span style="color: #000000;">master.info
</span><span style="color: #008080;">45</span>                     SQL_Delay: <span style="color: #800000; font-weight: bold;">0</span>
<span style="color: #008080;">46</span>           SQL_Remaining_Delay: <span style="color: #0000ff;">NULL</span>
<span style="color: #008080;">47</span>       Slave_SQL_Running_State: Slave has <span style="color: #0000ff;">read</span> <span style="color: #808080;">all</span> relay <span style="color: #ff00ff;">log</span>; waiting <span style="color: #0000ff;">for</span> the slave I<span style="color: #808080;">/</span>O thread <span style="color: #0000ff;">to</span> <span style="color: #0000ff;">update</span><span style="color: #000000;"> it
</span><span style="color: #008080;">48</span>            Master_Retry_Count: <span style="color: #800000; font-weight: bold;">86400</span>
<span style="color: #008080;">49</span> <span style="color: #000000;">                  Master_Bind: 
</span><span style="color: #008080;">50</span> <span style="color: #000000;">      Last_IO_Error_Timestamp: 
</span><span style="color: #008080;">51</span> <span style="color: #000000;">     Last_SQL_Error_Timestamp: 
</span><span style="color: #008080;">52</span> <span style="color: #000000;">               Master_SSL_Crl: 
</span><span style="color: #008080;">53</span> <span style="color: #000000;">           Master_SSL_Crlpath: 
</span><span style="color: #008080;">54</span> <span style="color: #000000;">           Retrieved_Gtid_Set: 
</span><span style="color: #008080;">55</span>             Executed_Gtid_Set: c8fcd56e<span style="color: #808080;">-</span>eb79<span style="color: #808080;">-</span>11e7<span style="color: #808080;">-</span>97b0<span style="color: #808080;">-</span>000c296c7a11:<span style="color: #800000; font-weight: bold;">1</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">3</span>
<span style="color: #008080;">56</span>                 Auto_Position: <span style="color: #800000; font-weight: bold;">1</span>
<span style="color: #008080;">57</span> <span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code åœæ‰ä¸»åº“åçš„ä¸»ä»ä¿¡æ¯</span></div>
</div>
<p>åœ¨db01ä¸ŠæŸ¥çœ‹vipä¿¡æ¯</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #800000; font-weight: bold;">2</span>: eth0: <span style="color: #808080;"><</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style="color: #808080;">></span> mtu <span style="color: #800000; font-weight: bold;">1500</span> qdisc pfifo_fast state UP qlen <span style="color: #800000; font-weight: bold;">1000</span><span style="color: #000000;">
    link</span><span style="color: #808080;">/</span>ether <span style="color: #800000; font-weight: bold;">00</span>:0c:<span style="color: #800000; font-weight: bold;">29</span>:6c:7a:<span style="color: #800000; font-weight: bold;">11</span><span style="color: #000000;"> brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.51</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">24</span> brd <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.255</span><span style="color: #000000;"> scope global eth0
    inet6 fe80::20c:29ff:fe6c:7a11</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">64</span><span style="color: #000000;"> scope link 
       valid_lft forever preferred_lft forever</span></pre>
</div>
</div>
<p>åœ¨db02ä¸ŠæŸ¥çœ‹vipä¿¡æ¯</p>
<div class="cnblogs_code">
<pre> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ceef3f3e8dcf8feacae">[email&#160;protected]</a> ~<span style="color: #000000;">]# ip a s eth0
</span><span style="color: #800080;">2</span>: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span style="color: #800080;">1500</span> qdisc pfifo_fast state UP qlen <span style="color: #800080;">1000</span><span style="color: #000000;">
    link</span>/ether <span style="color: #800080;">00</span>:0c:<span style="color: #800080;">29</span><span style="color: #000000;">:d6:0a:b3 brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.52</span>/<span style="color: #800080;">24</span> brd <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.255</span><span style="color: #000000;"> scope global eth0
inet </span><span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.55</span>/<span style="color: #800080;">24</span> brd <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.255</span> scope global secondary eth0:<span style="color: #800080;">0</span><span style="color: #000000;">
    inet6 fe80::20c:29ff:fed6:ab3</span>/<span style="color: #800080;">64</span><span style="color: #000000;"> scope link 
       valid_lft forever preferred_lft forever</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è‡³æ­¤ï¼ŒVIPæ¼‚ç§»å°±æµ‹è¯•æˆåŠŸ</p>
<h2>1.6 é…ç½®binlog-server</h2>
<h3>1.6.1 é…ç½®binlog-server</h3>
<p>1ï¼‰å‰æœŸå‡†å¤‡ï¼š</p>
<div>
<blockquote>
<p class="ad" style="color: #000000;">1ã€å‡†å¤‡ä¸€å°æ–°çš„mysqlå®ä¾‹(db03),GTIDå¿…é¡»å¼€å¯ã€‚</p>
<p class="ad" style="color: #000000;">2ã€å°†æ¥binlogæ¥æ”¶ç›®å½•ï¼Œä¸èƒ½å’Œä¸»åº“binlogç›®å½•ä¸€æ ·</p>
</blockquote>
</div>
<p>2ï¼‰åœæ­¢mha</p>
<div>
<div class="cnblogs_code">
<pre>masterha_stop --conf=/etc/mha/app1.cnf</pre>
</div>
</div>
<p>3ï¼‰åœ¨app1.cnfå¼€å¯binlogserveråŠŸèƒ½</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">    [binlog1]
    no_master</span>=<span style="color: #800080;">1</span>
    <span style="color: #0000ff;">hostname</span>=<span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.53</span>                         ----><span style="color: #000000;"> ä¸»æœºDB03
    master_binlog_dir</span>=/data/mysql/binlog/  ----> binlogä¿å­˜ç›®å½•</pre>
</div>
</div>
<p>4ï¼‰å¼€å¯binlogæ¥æ”¶ç›®å½•ï¼Œæ³¨æ„æƒé™</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">mkdir</span> -p /data/mysql/binlog/ 
<span style="color: #0000ff;">chown</span> -R mysql.mysql /data/<span style="color: #000000;">mysql
# è¿›å…¥ç›®å½•å¯åŠ¨ç¨‹åº
  cd </span>/data/mysql/binlog/ &&<span style="color: #000000;">\
  mysqlbinlog  </span>-R --host=<span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.51</span> --user=mha --password=mha --raw  --stop-never mysql-bin.<span style="color: #800080;">000001</span> &</pre>
</div>
</div>
<p>ã€€ã€€å‚æ•°è¯´æ˜ï¼š-R è¿œç¨‹ä¸»æœº</p>
<p>5ï¼‰å¯åŠ¨mha</p>
<div>
<div class="cnblogs_code">
<pre>nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover < /dev/<span style="color: #0000ff;">null</span> > /var/log/mha/app1/manager.log <span style="color: #800080;">2</span>>&<span style="color: #800080;">1</span> &</pre>
</div>
</div>
<h3>1.6.2 æµ‹è¯•binlogå¤‡ä»½</h3>
<div>
<p>#æŸ¥çœ‹binlogç›®å½•ä¸­çš„binlog</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8cad7d7ccf8dcda888b">[email&#160;protected]</a> binlog]# ll
total </span><span style="color: #800080;">44</span>
-rw-r--r-- <span style="color: #800080;">1</span> root root <span style="color: #800080;">285</span> Mar  <span style="color: #800080;">8</span> <span style="color: #800080;">03</span>:<span style="color: #800080;">11</span> mysql-bin.<span style="color: #800080;">000001</span></pre>
</div>
<p>#ç™»å½•ä¸»åº“</p>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ee9c81819aae83979d9f82c38a8cdedf">[email&#160;protected]</a> ~]# mysql -uroot -p123</pre>
</div>
<p>#åˆ·æ–°binlog</p>
<div class="cnblogs_code">
<pre>mysql> flush logs;</pre>
</div>
<p>#å†æ¬¡æŸ¥çœ‹binlogç›®å½•</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="55273a3a211531376566">[email&#160;protected]</a> binlog]# ll
total </span><span style="color: #800080;">48</span>
-rw-r--r-- <span style="color: #800080;">1</span> root root <span style="color: #800080;">285</span> Mar  <span style="color: #800080;">8</span> <span style="color: #800080;">03</span>:<span style="color: #800080;">11</span> mysql-bin.<span style="color: #800080;">000001</span>
-rw-r--r-- <span style="color: #800080;">1</span> root root <span style="color: #800080;">143</span> Mar  <span style="color: #800080;">8</span> <span style="color: #800080;">04</span>:<span style="color: #800080;">00</span> mysql-bin.<span style="color: #800080;">000002</span></pre>
</div>
</div>
<h2>1.7 mysqlä¸­é—´ä»¶Atlas</h2>
<h3>1.7.1 atlasç®€ä»‹</h3>
<p>ã€€ã€€Atlasæ˜¯ç”± Qihoo 360å…¬å¸Webå¹³å°éƒ¨åŸºç¡€æ¶æ„å›¢é˜Ÿå¼€å‘ç»´æŠ¤çš„ä¸€ä¸ªåŸºäºMySQLåè®®çš„æ•°æ®ä¸­é—´å±‚é¡¹ç›®ã€‚å®ƒåœ¨MySQLå®˜æ–¹æ¨å‡ºçš„MySQL-Proxy 0.8.2ç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹äº†å¤§é‡bugï¼Œæ·»åŠ äº†å¾ˆå¤šåŠŸèƒ½ç‰¹æ€§ã€‚ç›®å‰è¯¥é¡¹ç›®åœ¨360å…¬å¸å†…éƒ¨å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œå¾ˆå¤šMySQLä¸šåŠ¡å·²ç»æ¥å…¥äº†Atlaså¹³å°ï¼Œæ¯å¤©æ‰¿è½½çš„è¯»å†™è¯·æ±‚æ•°è¾¾å‡ åäº¿æ¡ã€‚</p>
<p>ã€€ã€€åŒæ—¶ï¼Œæœ‰è¶…è¿‡50å®¶å…¬å¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²äº†Atlasï¼Œè¶…è¿‡800äººå·²åŠ å…¥äº†æˆ‘ä»¬çš„å¼€å‘è€…äº¤æµç¾¤ï¼Œå¹¶ä¸”è¿™äº›æ•°å­—è¿˜åœ¨ä¸æ–­å¢åŠ ã€‚è€Œä¸”å®‰è£…æ–¹ä¾¿ã€‚é…ç½®çš„æ³¨é‡Šå†™çš„è›®è¯¦ç»†çš„ï¼Œéƒ½æ˜¯ä¸­æ–‡ã€‚</p>
<div>
<p class="a4">ã€€ã€€Atlaså®˜æ–¹é“¾æ¥ï¼š <a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/blob/master/README_ZH.md  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/blob/master/README_ZH.md'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/blob/master/README_ZH.md"  target="_blank">https://github.com/Qihoo360/Atlas/blob/master/README_ZH.md</a></p>
<p class="a4">ã€€ã€€Atlasä¸‹è½½é“¾æ¥ï¼š<a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=%20https://github.com/Qihoo360/Atlas/releases  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=%20https://github.com/Qihoo360/Atlas/releases'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=%20https://github.com/Qihoo360/Atlas/releases"  target="_blank"> https://github.com/Qihoo360/Atlas/releases</a></p>
</div>
<h3>1.7.2 ä¸»è¦åŠŸèƒ½</h3>
<p>ã€€ã€€è¯»å†™åˆ†ç¦»ã€ä»åº“è´Ÿè½½å‡è¡¡ã€è‡ªåŠ¨åˆ†è¡¨ã€IPè¿‡æ»¤</p>
<p>ã€€ã€€SQLè¯­å¥é»‘ç™½åå•ã€DBAå¯å¹³æ»‘ä¸Šä¸‹çº¿DBã€è‡ªåŠ¨æ‘˜é™¤å®•æœºçš„DB</p>
<p><em><span style="text-decoration: underline;">Atlas</span></em><em><span style="text-decoration: underline;">ç›¸å¯¹äºå®˜æ–¹MySQL-Proxy</span></em><em><span style="text-decoration: underline;">çš„ä¼˜åŠ¿</span></em></p>
<blockquote>
<p style="color: #000000;">1.å°†ä¸»æµç¨‹ä¸­æ‰€æœ‰Luaä»£ç ç”¨Cé‡å†™ï¼ŒLuaä»…ç”¨äºç®¡ç†æ¥å£</p>
<p style="color: #000000;">2.é‡å†™ç½‘ç»œæ¨¡å‹ã€çº¿ç¨‹æ¨¡å‹</p>
<p style="color: #000000;">3.å®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥æ± </p>
<p>&nbsp;</p>
<p style="color: #000000;">4.ä¼˜åŒ–äº†é”æœºåˆ¶ï¼Œæ€§èƒ½æé«˜æ•°åå€&nbsp;</p>
</blockquote>
<h3>1.7.3 ä½¿ç”¨åœºæ™¯</h3>
<p>ã€€ã€€Atlasæ˜¯ä¸€ä¸ªä½äºå‰ç«¯åº”ç”¨ä¸åç«¯MySQLæ•°æ®åº“ä¹‹é—´çš„ä¸­é—´ä»¶ï¼Œå®ƒä½¿å¾—åº”ç”¨ç¨‹åºå‘˜æ— éœ€å†å…³å¿ƒè¯»å†™åˆ†ç¦»ã€åˆ†è¡¨ç­‰ä¸MySQLç›¸å…³çš„ç»†èŠ‚ï¼Œå¯ä»¥ä¸“æ³¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼ŒåŒæ—¶ä½¿å¾—DBAçš„è¿ç»´å·¥ä½œå¯¹å‰ç«¯åº”ç”¨é€æ˜ï¼Œä¸Šä¸‹çº¿DBå‰ç«¯åº”ç”¨æ— æ„ŸçŸ¥ã€‚</p>
<p align="center">&nbsp;<img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230181901679-91103503.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<p>ã€€ã€€Atlasæ˜¯ä¸€ä¸ªä½äºåº”ç”¨ç¨‹åºä¸MySQLä¹‹é—´ä¸­é—´ä»¶ã€‚åœ¨åç«¯DBçœ‹æ¥ï¼ŒAtlasç›¸å½“äºè¿æ¥å®ƒçš„å®¢æˆ·ç«¯ï¼Œåœ¨å‰ç«¯åº”ç”¨çœ‹æ¥ï¼ŒAtlasç›¸å½“äºä¸€ä¸ªDBã€‚</p>
<p>ã€€ã€€Atlasä½œä¸ºæœåŠ¡ç«¯ä¸åº”ç”¨ç¨‹åºé€šè®¯ï¼Œå®ƒå®ç°äº†MySQLçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åè®®ï¼ŒåŒæ—¶ä½œä¸ºå®¢æˆ·ç«¯ä¸MySQLé€šè®¯ã€‚å®ƒå¯¹åº”ç”¨ç¨‹åºå±è”½äº†DBçš„ç»†èŠ‚ï¼ŒåŒæ—¶ä¸ºäº†é™ä½MySQLè´Ÿæ‹…ï¼Œå®ƒè¿˜ç»´æŠ¤äº†è¿æ¥æ± .</p>
<h3>1.7.4 ä¼ä¸šè¯»å†™åˆ†ç¦»åŠåˆ†åº“åˆ†è¡¨å…¶ä»–æ–¹æ¡ˆä»‹ç»</h3>
<div>
<blockquote>
<p class="a4">&nbsp; &nbsp; Mysql-proxyï¼ˆoracleï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Mysql-routerï¼ˆoracleï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Atlas (Qihoo 360)</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Atlas-sharding (Qihoo 360)</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Cobarï¼ˆæ˜¯é˜¿é‡Œå·´å·´ï¼ˆB2Bï¼‰éƒ¨é—¨å¼€å‘ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Mycatï¼ˆåŸºäºé˜¿é‡Œå¼€æºçš„Cobaräº§å“è€Œç ”å‘ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; TDDL Smart Clientçš„æ–¹å¼ï¼ˆæ·˜å®ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Oceanus(58åŒåŸæ•°æ®åº“ä¸­é—´ä»¶)</p>
<p class="a4">&nbsp;&nbsp;&nbsp; OneProxyï¼ˆåŸæ”¯ä»˜å®é¦–å¸­æ¶æ„å¸ˆæ¥¼æ–¹é‘«å¼€å‘ ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; vitessï¼ˆè°·æ­Œå¼€å‘çš„æ•°æ®åº“ä¸­é—´ä»¶ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Heisenberg(ç™¾åº¦)</p>
<p class="a4">&nbsp;&nbsp;&nbsp; TSharding(è˜‘è‡è¡—ç™½è¾‰)</p>
<p class="a4">&nbsp;&nbsp;&nbsp; Xx-dbproxyï¼ˆé‡‘å±±çš„Kingshardã€å½“å½“ç½‘çš„sharding-jdbc ï¼‰</p>
<p class="a4">&nbsp;&nbsp;&nbsp; amoeba</p>
</blockquote>
</div>
<h3>1.7.5 å®‰è£…Atlas</h3>
<p>ã€€ã€€è½¯ä»¶è·å–åœ°å€ï¼š<a href="javascript:if(confirm('http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/releases  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/releases'" tppabs="http://clsn.io/wp-content/themes/clsn-003/inc/go.php?url=https://github.com/Qihoo360/Atlas/releases"  target="_blank">https://github.com/Qihoo360/Atlas/releases</a></p>
<p><em><span style="text-decoration: underline;">æ³¨æ„ï¼š</span></em></p>
<div>
<blockquote>
<p class="a4">1ã€Atlasåªèƒ½å®‰è£…è¿è¡Œåœ¨64ä½çš„ç³»ç»Ÿä¸Š</p>
<p class="a4">2ã€Centos 5.Xå®‰è£… Atlas-XX.el5.x86_64.rpmï¼ŒCentos 6.Xå®‰è£…Atlas-XX.el6.x86_64.rpmã€‚</p>
<p class="a4">3ã€åç«¯mysqlç‰ˆæœ¬åº”å¤§äº5.1ï¼Œå»ºè®®ä½¿ç”¨Mysql 5.6ä»¥ä¸Š</p>
<p class="a4">ã€€ã€€Atlas (æ™®é€š) : Atlas-2.2.1.el6.x86_64.rpm</p>
<p class="a4">ã€€ã€€Atlas (åˆ†è¡¨) : Atlas-sharding_1.0.1-el6.x86_64.rpm</p>
</blockquote>
</div>
<p>&nbsp;ä¸‹è½½å®‰è£…atlas</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">wget</span> https:<span style="color: #008000;">//</span><span style="color: #008000;">github.com/Qihoo360/Atlas/releases/download/2.2.1/Atlas-2.2.1.el6.x86_64.rpm</span>
rpm -ivh Atlas-<span style="color: #800080;">2.2</span>.<span style="color: #800080;">1</span>.el6.x86_64.rpm</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #00ff00; color: #ffffff;">è‡³æ­¤å®‰è£…å®Œæˆ</span></p>
<h3>1.7.6 é…ç½®Atlasé…ç½®æ–‡ä»¶</h3>
<p>ã€€ã€€atlasé…ç½®æ–‡ä»¶ä¸­çš„å¯†ç éœ€è¦åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œè½¯ä»¶è‡ªå¸¦çš„åŠ å¯†å·¥å…·è¿›è¡ŒåŠ å¯†</p>
<div>
<div class="cnblogs_code">
<pre>cd /usr/local/mysql-proxy/conf/
/usr/local/mysql-proxy/bin/encrypt  å¯†ç       ---->åˆ¶ä½œåŠ å¯†å¯†ç </pre>
</div>
</div>
<p>ç”Ÿäº§å¯†æ–‡å¯†ç ï¼š</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="eb9984849fab8f89dbd8">[email&#160;protected]</a> bin]# /usr/local/mysql-proxy/bin/encrypt <span style="color: #800080;">123</span><span style="color: #000000;">
3yb5jEku5h4</span>=<span style="color: #000000;">
[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="53213c3c271337316360">[email&#160;protected]</a> bin]# </span>/usr/local/mysql-proxy/bin/<span style="color: #000000;">encrypt mha
O2jBXONX098</span>=</pre>
</div>
</div>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p>
<div>
<div class="cnblogs_code">
<pre>vim  /usr/local/mysql-proxy/conf/<span style="color: #000000;">test.cnf
[mysql</span>-<span style="color: #000000;">proxy]
admin</span>-username =<span style="color: #000000;"> user
admin</span>-password = <span style="color: #0000ff;">pwd</span><span style="color: #000000;">
proxy</span>-backend-addresses = <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.55</span>:<span style="color: #800080;">3306</span><span style="color: #000000;">
proxy</span>-read-only-backend-addresses = <span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.52</span>:<span style="color: #800080;">3306</span>,<span style="color: #800080;">10.0</span>.<span style="color: #800080;">0.53</span>:<span style="color: #800080;">3306</span><span style="color: #000000;">
pwds </span>= repl:3yb5jEku5h4=,mha:O2jBXONX098=<span style="color: #000000;">
daemon </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">
keepalive </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">
event</span>-threads = <span style="color: #800080;">8</span><span style="color: #000000;">
log</span>-level =<span style="color: #000000;"> message
log</span>-path = /usr/local/mysql-proxy/<span style="color: #000000;">log
sql</span>-log=<span style="color: #000000;">ON
proxy</span>-address = <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">33060</span><span style="color: #000000;">
admin</span>-address = <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">2345</span><span style="color: #000000;">
charset</span>=utf8</pre>
</div>
</div>
<p>é…ç½®æ–‡ä»¶å†…ä¸ºå…¨ä¸­æ–‡æ³¨é‡Šï¼Œè¿™é‡Œæœ‰ä¸€ä»½è¾ƒä¸ºè¯¦ç»†çš„è§£é‡Šï¼š</p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('cc7f89f5-379e-44a4-a5e9-6798f05addfe')"><img id="code_img_closed_cc7f89f5-379e-44a4-a5e9-6798f05addfe" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_cc7f89f5-379e-44a4-a5e9-6798f05addfe" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('cc7f89f5-379e-44a4-a5e9-6798f05addfe',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_cc7f89f5-379e-44a4-a5e9-6798f05addfe" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [mysql-<span style="color: #000000;">proxy]
</span><span style="color: #008080;"> 2</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)ç®¡ç†æ¥å£çš„ç”¨æˆ·å</span>
<span style="color: #008080;"> 3</span> admin-username =<span style="color: #000000;"> user
</span><span style="color: #008080;"> 4</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)ç®¡ç†æ¥å£çš„å¯†ç </span>
<span style="color: #008080;"> 5</span> admin-password =<span style="color: #000000;"> pwd
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½®)ä¸»åº“çš„IPå’Œç«¯å£</span>
<span style="color: #008080;"> 7</span> proxy-backend-addresses = 192.168.0.12:3306
<span style="color: #008080;"> 8</span> <span style="color: #008000;">#</span><span style="color: #008000;">(éå¿…å¤‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½®)ä»åº“çš„IPå’Œç«¯å£ï¼Œ@åé¢çš„æ•°å­—ä»£è¡¨æƒé‡ï¼Œç”¨æ¥ä½œè´Ÿè½½å‡è¡¡ï¼Œè‹¥çœç•¥åˆ™é»˜è®¤ä¸º1ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš”ã€‚å¦‚æœæƒ³è®©ä¸»åº“ä¹Ÿèƒ½åˆ†æ‹…è¯»è¯·æ±‚çš„è¯ï¼Œåªéœ€è¦å°†ä¸»åº“ä¿¡æ¯åŠ å…¥åˆ°ä¸‹é¢çš„é…ç½®é¡¹ä¸­</span>
<span style="color: #008080;"> 9</span> proxy-read-only-backend-addresses = 192.168.0.13:3306,192.168.0.14:3306
<span style="color: #008080;">10</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½®)ç”¨æˆ·åä¸å…¶å¯¹åº”çš„åŠ å¯†è¿‡çš„MySQLå¯†ç ï¼Œå¯†ç ä½¿ç”¨PREFIX/binç›®å½•ä¸‹çš„åŠ å¯†ç¨‹åºencryptåŠ å¯†ï¼Œç”¨æˆ·åä¸å¯†ç ä¹‹é—´ç”¨å†’å·åˆ†éš”ã€‚ä¸»ä»æ•°æ®åº“ä¸Šéœ€è¦å…ˆåˆ›å»ºè¯¥ç”¨æˆ·å¹¶è®¾ç½®å¯†ç ï¼ˆç”¨æˆ·åå’Œå¯†ç åœ¨ä¸»ä»æ•°æ®åº“ä¸Šè¦ä¸€è‡´ï¼‰ã€‚æ¯”å¦‚ç”¨æˆ·åä¸ºmyuserï¼Œå¯†ç ä¸ºmypwdï¼Œæ‰§è¡Œ./encrypt mypwdç»“æœä¸ºHJBoxfRsjeI=ã€‚å¦‚æœæœ‰å¤šä¸ªç”¨æˆ·ç”¨é€—å·åˆ†éš”å³å¯ã€‚åˆ™è®¾ç½®å¦‚ä¸‹è¡Œæ‰€ç¤ºï¼š</span>
<span style="color: #008080;">11</span> pwds = myuser: HJBoxfRsjeI=,myuser2:HJBoxfRsjeI=
<span style="color: #008080;">12</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼ï¼Œè®¾ä¸ºfalseæ—¶ä¸ºå‰å°æ–¹å¼ï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue</span>
<span style="color: #008080;">13</span> daemon =<span style="color: #000000;"> true
</span><span style="color: #008080;">14</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶Atlasä¼šå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªä¸ºmonitorï¼Œä¸€ä¸ªä¸ºworkerï¼Œmonitoråœ¨workeræ„å¤–é€€å‡ºåä¼šè‡ªåŠ¨å°†å…¶é‡å¯ï¼Œè®¾ä¸ºfalseæ—¶åªæœ‰workerï¼Œæ²¡æœ‰monitorï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue</span>
<span style="color: #008080;">15</span> keepalive =<span style="color: #000000;"> true
</span><span style="color: #008080;">16</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½®)å·¥ä½œçº¿ç¨‹æ•°ï¼Œæ¨èè®¾ç½®æˆç³»ç»Ÿçš„CPUæ ¸æ•°</span>
<span style="color: #008080;">17</span> <span style="color: #008000;">#</span><span style="color: #008000;"> å¯¹æ€§èƒ½å’Œæ­£å¸¸è¿è¡Œèµ·åˆ°é‡è¦ä½œç”¨</span>
<span style="color: #008080;">18</span> event-threads = 4
<span style="color: #008080;">19</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)æ—¥å¿—çº§åˆ«ï¼Œåˆ†ä¸ºmessageã€warningã€criticalã€errorã€debugäº”ä¸ªçº§åˆ«</span>
<span style="color: #008080;">20</span> log-level =<span style="color: #000000;"> message
</span><span style="color: #008080;">21</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)æ—¥å¿—å­˜æ”¾çš„è·¯å¾„</span>
<span style="color: #008080;">22</span> log-path = /usr/local/mysql-proxy/<span style="color: #000000;">log
</span><span style="color: #008080;">23</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½®)SQLæ—¥å¿—çš„å¼€å…³ï¼Œå¯è®¾ç½®ä¸ºOFFã€ONã€REALTIMEï¼ŒOFFä»£è¡¨ä¸è®°å½•SQLæ—¥å¿—ï¼ŒONä»£è¡¨è®°å½•SQLæ—¥å¿—ï¼Œè¯¥æ¨¡å¼ä¸‹æ—¥å¿—åˆ·æ–°æ˜¯åŸºäºç¼“å†²åŒºçš„ï¼Œå½“æ—¥å¿—å¡«æ»¡ç¼“å†²åŒºåï¼Œæ‰å°†æ—¥å¿—ä¿¡æ¯åˆ·åˆ°ç£ç›˜ã€‚REALTIMEç”¨äºè°ƒè¯•ï¼Œä»£è¡¨è®°å½•SQLæ—¥å¿—ä¸”å®æ—¶å†™å…¥ç£ç›˜ï¼Œé»˜è®¤ä¸ºOFF</span>
<span style="color: #008080;">24</span> sql-log =<span style="color: #000000;"> OFF
</span><span style="color: #008080;">25</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œå¯ä¸è®¾ç½®ï¼‰æ…¢æ—¥å¿—è¾“å‡ºè®¾ç½®ã€‚å½“è®¾ç½®äº†è¯¥å‚æ•°æ—¶ï¼Œåˆ™æ—¥å¿—åªè¾“å‡ºæ‰§è¡Œæ—¶é—´è¶…è¿‡sql-log-slowï¼ˆå•ä½ï¼šms)çš„æ—¥å¿—è®°å½•ã€‚ä¸è®¾ç½®è¯¥å‚æ•°åˆ™è¾“å‡ºå…¨éƒ¨æ—¥å¿—ã€‚</span>
<span style="color: #008080;">26</span> sql-log-slow = 10
<span style="color: #008080;">27</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œå¯ä¸è®¾ç½®ï¼‰å…³é—­ä¸æ´»è·ƒçš„å®¢æˆ·ç«¯è¿æ¥è®¾ç½®ã€‚å½“è®¾ç½®äº†è¯¥å‚æ•°æ—¶ï¼ŒAtlasä¼šä¸»åŠ¨å…³é—­ç»è¿‡'wait-timeout'æ—¶é—´åä¸€ç›´æœªæ´»è·ƒçš„è¿æ¥ã€‚å•ä½ï¼šç§’</span>
<span style="color: #008080;">28</span> wait-timeout = 10
<span style="color: #008080;">29</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)Atlasç›‘å¬çš„å·¥ä½œæ¥å£IPå’Œç«¯å£ï¼›ä»£è¡¨å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨1234è¿™ä¸ªç«¯å£è¿æ¥Atlasæ¥å‘é€SQLè¯·æ±‚ã€‚</span>
<span style="color: #008080;">30</span> proxy-address = 0.0.0.0:1234
<span style="color: #008080;">31</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¿…å¤‡ï¼Œé»˜è®¤å€¼å³å¯)Atlasç›‘å¬çš„ç®¡ç†æ¥å£IPå’Œç«¯å£ ï¼›ä»£è¡¨DBAåº”è¯¥ä½¿ç”¨2345è¿™ä¸ªç«¯å£è¿æ¥Atlasæ¥æ‰§è¡Œè¿ç»´ç®¡ç†æ“ä½œã€‚</span>
<span style="color: #008080;">32</span> admin-address = 0.0.0.0:2345
<span style="color: #008080;">33</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œå¯ä¸è®¾ç½®)åˆ†è¡¨è®¾ç½®ï¼Œæ­¤ä¾‹ä¸­personä¸ºåº“åï¼Œmtä¸ºè¡¨åï¼Œidä¸ºåˆ†è¡¨å­—æ®µï¼Œ3ä¸ºå­è¡¨æ•°é‡ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸åˆ†è¡¨åˆ™ä¸éœ€è¦è®¾ç½®è¯¥é¡¹ï¼Œå­è¡¨éœ€è¦äº‹å…ˆå»ºå¥½ï¼Œå­è¡¨åç§°ä¸ºè¡¨å_æ•°å­—ï¼Œæ•°å­—èŒƒå›´ä¸º[0,å­è¡¨æ•°-1]ï¼Œå¦‚æœ¬ä¾‹é‡Œï¼Œå­è¡¨åç§°ä¸ºmt_0ã€mt_1ã€mt_2</span>
<span style="color: #008080;">34</span> tables = person.mt.id.3
<span style="color: #008080;">35</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œå¯ä¸è®¾ç½®)é»˜è®¤å­—ç¬¦é›†ï¼Œè‹¥ä¸è®¾ç½®è¯¥é¡¹ï¼Œåˆ™é»˜è®¤å­—ç¬¦é›†ä¸ºlatin1</span>
<span style="color: #008080;">36</span> charset =<span style="color: #000000;"> utf8
</span><span style="color: #008080;">37</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œå¯ä¸è®¾ç½®)å…è®¸è¿æ¥Atlasçš„å®¢æˆ·ç«¯çš„IPï¼Œå¯ä»¥æ˜¯ç²¾ç¡®IPï¼Œä¹Ÿå¯ä»¥æ˜¯IPæ®µï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸è®¾ç½®è¯¥é¡¹åˆ™å…è®¸æ‰€æœ‰IPè¿æ¥ï¼Œå¦åˆ™åªå…è®¸åˆ—è¡¨ä¸­çš„IPè¿æ¥</span>
<span style="color: #008080;">38</span> client-ips = 127.0.0.1, 192.168.1
<span style="color: #008080;">39</span> <span style="color: #008000;">#</span><span style="color: #008000;">(å¯é€‰é¡¹ï¼Œæå°‘éœ€è¦)Atlaså‰é¢æŒ‚æ¥çš„LVSçš„ç‰©ç†ç½‘å¡çš„IP(æ³¨æ„ä¸æ˜¯è™šIP)ï¼Œè‹¥æœ‰LVSä¸”è®¾ç½®äº†client-ipsåˆ™æ­¤é¡¹å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™å¯ä»¥ä¸è®¾ç½®</span>
<span style="color: #008080;">40</span> lvs-ips = 192.168.1.1</pre>
</div>
<p><span class="cnblogs_code_collapse">View Code Atlasé…ç½®æ–‡ä»¶è¯´æ˜</span></div>
</div>
<h3>1.7.7 å¯åŠ¨Atlas</h3>
<p>ç¼–å†™ä¸€ä¸ªatlasçš„ç®¡ç†è„šæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†™è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨çš„ç®¡ç†ï¼š</p>
<div>
<div class="cnblogs_code">
<pre>/usr/local/mysql-proxy/bin/mysql-proxyd test start   <span style="color: #008000;">#</span><span style="color: #008000;">å¯åŠ¨</span>
/usr/local/mysql-proxy/bin/mysql-proxyd test stop    <span style="color: #008000;">#</span><span style="color: #008000;">åœæ­¢</span>
/usr/local/mysql-proxy/bin/mysql-proxyd test restart <span style="color: #008000;">#</span><span style="color: #008000;">é‡å¯</span></pre>
</div>
<p>ã€€ã€€æ³¨æ„ï¼štestæ˜¯é…ç½®æ–‡ä»¶çš„åç§°</p>
</div>
<p>è„šæœ¬å†…å®¹ï¼š</p>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('d45ef69b-9876-450c-bb26-61fbc042600d')"><img id="code_img_closed_d45ef69b-9876-450c-bb26-61fbc042600d" class="code_img_closed" src="ContractedBlock-4.gif" tppabs="http://clsn.io/wp-content/uploads/2018/03/ContractedBlock-4.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /><img id="code_img_opened_d45ef69b-9876-450c-bb26-61fbc042600d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d45ef69b-9876-450c-bb26-61fbc042600d',event)" data-original="http://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-4.gif" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<div id="cnblogs_code_open_d45ef69b-9876-450c-bb26-61fbc042600d" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> [<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="04766b6b704460663437">[email&#160;protected]</a> ~]# <span style="color: #0000ff;">cat</span> /etc/init.d/<span style="color: #000000;">atlasd 
</span><span style="color: #008080;"> 2</span> #!/bin/<span style="color: #0000ff;">sh</span>
<span style="color: #008080;"> 3</span> <span style="color: #000000;">#
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;"># atlas:    Atlas Daemon
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">#
</span><span style="color: #008080;"> 6</span> # chkconfig:    - <span style="color: #800080;">90</span> <span style="color: #800080;">25</span>
<span style="color: #008080;"> 7</span> <span style="color: #000000;"># description:  Atlas Daemon
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;"># user:clsn
</span><span style="color: #008080;"> 9</span> # Blog: http:<span style="color: #008000;">//</span><span style="color: #008000;">blog.nmtui.com</span>
<span style="color: #008080;">10</span> # Source <span style="color: #0000ff;">function</span><span style="color: #000000;"> library.
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> Demo=<span style="color: #000000;">test
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #000000;">start()
</span><span style="color: #008080;">15</span> <span style="color: #000000;">{
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">echo</span> -n $<span style="color: #800000;">"</span><span style="color: #800000;">Starting atlas: </span><span style="color: #800000;">"</span>
<span style="color: #008080;">17</span>         /usr/local/mysql-proxy/bin/mysql-<span style="color: #000000;">proxyd $Demo start
</span><span style="color: #008080;">18</span> <span style="color: #000000;">}
</span><span style="color: #008080;">19</span> <span style="color: #000000;">stop()
</span><span style="color: #008080;">20</span> <span style="color: #000000;">{
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">echo</span> -n $<span style="color: #800000;">"</span><span style="color: #800000;">Shutting down atlas: </span><span style="color: #800000;">"</span>
<span style="color: #008080;">22</span>         /usr/local/mysql-proxy/bin/mysql-<span style="color: #000000;">proxyd $Demo stop
</span><span style="color: #008080;">23</span> <span style="color: #000000;">}
</span><span style="color: #008080;">24</span> <span style="color: #000000;">status()
</span><span style="color: #008080;">25</span> <span style="color: #000000;">{
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">echo</span>  $<span style="color: #800000;">"</span><span style="color: #800000;">Atlas status: </span><span style="color: #800000;">"</span>
<span style="color: #008080;">27</span>         /usr/local/mysql-proxy/bin/mysql-<span style="color: #000000;">proxyd $Demo status
</span><span style="color: #008080;">28</span> <span style="color: #000000;">}
</span><span style="color: #008080;">29</span> <span style="color: #000000;">restart()
</span><span style="color: #008080;">30</span> <span style="color: #000000;">{
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">echo</span> $<span style="color: #800000;">"</span><span style="color: #800000;">Atlas Restart Info: </span><span style="color: #800000;">"</span>
<span style="color: #008080;">32</span>         /usr/local/mysql-proxy/bin/mysql-<span style="color: #000000;">proxyd $Demo restart
</span><span style="color: #008080;">33</span> <span style="color: #000000;">}
</span><span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> ATLAS=<span style="color: #800000;">"</span><span style="color: #800000;">/usr/local/mysql-proxy/bin/mysql-proxyd</span><span style="color: #800000;">"</span>
<span style="color: #008080;">37</span> [ -f $ATLAS ] || exit <span style="color: #800080;">1</span>
<span style="color: #008080;">38</span> <span style="color: #000000;"># See how we were called.
</span><span style="color: #008080;">39</span> <span style="color: #0000ff;">case</span> <span style="color: #800000;">"</span><span style="color: #800000;">$1</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">in</span>
<span style="color: #008080;">40</span> <span style="color: #000000;">        start)
</span><span style="color: #008080;">41</span> <span style="color: #000000;">                start
</span><span style="color: #008080;">42</span> <span style="color: #000000;">                ;;
</span><span style="color: #008080;">43</span> <span style="color: #000000;">        stop)
</span><span style="color: #008080;">44</span> <span style="color: #000000;">                stop
</span><span style="color: #008080;">45</span> <span style="color: #000000;">                ;;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        restart)
</span><span style="color: #008080;">47</span> <span style="color: #000000;">                restart
</span><span style="color: #008080;">48</span> <span style="color: #000000;">                ;;
</span><span style="color: #008080;">49</span> <span style="color: #000000;">        status)
</span><span style="color: #008080;">50</span> <span style="color: #000000;">                status
</span><span style="color: #008080;">51</span> <span style="color: #000000;">                ;;
</span><span style="color: #008080;">52</span>         *<span style="color: #000000;">)
</span><span style="color: #008080;">53</span>                 <span style="color: #0000ff;">echo</span> $<span style="color: #800000;">"</span><span style="color: #800000;">Usage: $0 {start|stop|restart|status}</span><span style="color: #800000;">"</span>
<span style="color: #008080;">54</span>                 exit <span style="color: #800080;">1</span>
<span style="color: #008080;">55</span> <span style="color: #0000ff;">esac</span>
<span style="color: #008080;">56</span> exit <span style="color: #800080;">0</span></pre>
</div>
<p><span class="cnblogs_code_collapse">View Code Atasç®¡ç†è„šæœ¬</span></div>
</div>
<p>æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£å¸¸</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1f6d70706b5f7b7d2f2c">[email&#160;protected]</a> ~]# netstat -lntup|<span style="color: #0000ff;">grep</span> mysql-<span style="color: #000000;">proxy
tcp        </span><span style="color: #800080;">0</span>      <span style="color: #800080;">0</span> <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">33060</span>               <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:*                   LISTEN      <span style="color: #800080;">2125</span>/mysql-<span style="color: #000000;">proxy    
tcp        </span><span style="color: #800080;">0</span>      <span style="color: #800080;">0</span> <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">2345</span>                <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:*                   LISTEN      <span style="color: #800080;">2125</span>/mysql-proxy</pre>
</div>
</div>
<h3>1.7.8 Atlasç®¡ç†æ“ä½œ</h3>
<p>ã€€ã€€ç™»å…¥ç®¡ç†æ¥å£</p>
<div>
<div class="cnblogs_code">
<pre>[<a href="email-protection.htm" tppabs="http://clsn.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cebca1a1ba8eaaacfefd">[email&#160;protected]</a> ~]# mysql -uuser -ppwd -h127.<span style="color: #800080;">0.0</span>.<span style="color: #800080;">1</span> -P2345</pre>
</div>
<p class="ad">ã€€ã€€æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SELECT</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">FROM</span> help;</pre>
</div>
<p class="ad">ã€€ã€€æŸ¥çœ‹åç«¯çš„ä»£ç†åº“</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SELECT</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">FROM</span><span style="color: #000000;"> backends;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span> backend_ndx <span style="color: #808080;">|</span> address        <span style="color: #808080;">|</span> state <span style="color: #808080;">|</span> type <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.55</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> rw   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.52</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> ro   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.53</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> ro   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #800000; font-weight: bold;">3</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p>ã€€ã€€å¹³æ»‘æ‘˜é™¤mysql</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span>  REMOVE BACKEND <span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">;
Empty </span><span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p class="ad">ã€€ã€€&nbsp;æ£€æŸ¥æ˜¯å¦æ‘˜é™¤</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SELECT</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">FROM</span><span style="color: #000000;"> backends;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span> backend_ndx <span style="color: #808080;">|</span> address        <span style="color: #808080;">|</span> state <span style="color: #808080;">|</span> type <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.55</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> rw   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.53</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> ro   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #800000; font-weight: bold;">2</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p>ã€€ã€€ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SAVE</span> CONFIG;</pre>
</div>
<p class="ad">ã€€ã€€å°†èŠ‚ç‚¹å†æ·»åŠ å›æ¥</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">add</span> slave <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.52</span>:<span style="color: #800000; font-weight: bold;">3306</span><span style="color: #000000;">;
Empty </span><span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p class="ad">ã€€ã€€æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ</p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SELECT</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">FROM</span><span style="color: #000000;"> backends;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span> backend_ndx <span style="color: #808080;">|</span> address        <span style="color: #808080;">|</span> state <span style="color: #808080;">|</span> type <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.55</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> rw   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.53</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> ro   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span>           <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">10.0</span>.<span style="color: #800000; font-weight: bold;">0.52</span>:<span style="color: #800000; font-weight: bold;">3306</span> <span style="color: #808080;">|</span> up    <span style="color: #808080;">|</span> ro   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------+----------------+-------+------+</span>
<span style="color: #800000; font-weight: bold;">3</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
<p>ã€€ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­</p>
<div class="cnblogs_code">
<pre>mysql> SAVE CONFIG;</pre>
</div>
</div>
<h3>1.7.9 è¿æ¥æ•°æ®åº“æŸ¥çœ‹è´Ÿè½½</h3>
<p>é€šè¿‡atlasç™»é™†æ•°æ®ï¼Œæ³¨æ„ï¼Œä½¿ç”¨çš„æ˜¯æ•°æ®åº“ä¸Šçš„ç”¨æˆ·åŠå¯†ç </p>
<div>
<div class="cnblogs_code">
<pre>shell<span style="color: #808080;">></span> mysql <span style="color: #808080;">-</span>umha <span style="color: #808080;">-</span>pmha <span style="color: #808080;">-</span>h127.<span style="color: #800000; font-weight: bold;">0.0</span>.<span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">-</span>P33060</pre>
</div>
</div>
<p>ç¬¬ä¸€æ¬¡æŸ¥è¯¢server_id</p>
<div>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span><span style="color: #000000;"> "server_id";
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> server_id     <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">53</span>    <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
</div>
<p>ç¬¬äºŒæ¬¡æŸ¥è¯¢server_id</p>
<div>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span><span style="color: #000000;"> "server_id";
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> server_id     <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">52</span>    <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><em>é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹åˆ°è´Ÿè½½æˆåŠŸ</em></strong></p>
<h3>1.7.10 è¯»å†™åˆ†ç¦»çš„è¯´æ˜</h3>
<p>ã€€ã€€Atlasä¼šé€æ˜çš„å°†äº‹åŠ¡è¯­å¥å’Œå†™è¯­å¥å‘é€è‡³ä¸»åº“æ‰§è¡Œï¼Œè¯»è¯­å¥å‘é€è‡³ä»åº“æ‰§è¡Œã€‚å…·ä½“ä»¥ä¸‹è¯­å¥ä¼šåœ¨ä¸»åº“æ‰§è¡Œï¼š</p>
<p>æ˜¾å¼äº‹åŠ¡ä¸­çš„è¯­å¥</p>
<blockquote>
<p>autocommit=0æ—¶çš„æ‰€æœ‰è¯­å¥</p>
<p>å«æœ‰select GET_LOCK()çš„è¯­å¥</p>
<p>é™¤SELECTã€SETã€USEã€SHOWã€DESCã€EXPLAINå¤–çš„ã€‚</p>
</blockquote>
<p><strong>ä»åº“è´Ÿè½½å‡è¡¡é…ç½®</strong></p>
<div>
<div class="cnblogs_code">
<pre>proxy<span style="color: #808080;">-</span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #0000ff;">only</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses<span style="color: #808080;">=</span>ip1:port1<span style="color: #008000;">@æƒé‡</span>,ip2:port2<span style="color: #008000;">@æƒé‡</span></pre>
</div>
</div>
<h3>1.7.11 Atlasé«˜çº§åŠŸèƒ½</h3>
<p><span style="background-color: #00ff00;"><strong>è‡ªåŠ¨åˆ†è¡¨</strong></span></p>
<p>ã€€ã€€ä½¿ç”¨Atlasçš„åˆ†è¡¨åŠŸèƒ½æ—¶ï¼Œé¦–å…ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶test.cnfè®¾ç½®tableså‚æ•°ã€‚</p>
<p>tableså‚æ•°è®¾ç½®æ ¼å¼ï¼šæ•°æ®åº“å.è¡¨å.åˆ†è¡¨å­—æ®µ.å­è¡¨æ•°é‡ï¼Œæ¯”å¦‚ï¼š</p>
<div>
<blockquote>
<p class="a4">ä½ çš„æ•°æ®åº“åå«schoolï¼Œè¡¨åå«stuï¼Œåˆ†è¡¨å­—æ®µå«idï¼Œæ€»å…±åˆ†ä¸º2å¼ è¡¨ï¼Œé‚£ä¹ˆå°±å†™ä¸ºschool.stu.id.2ï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–çš„åˆ†è¡¨ï¼Œä»¥é€—å·åˆ†éš”å³å¯ã€‚</p>
<p class="a4">ç”¨æˆ·éœ€è¦æ‰‹åŠ¨å»ºç«‹2å¼ å­è¡¨ï¼ˆstu_0,stu_1ï¼Œæ³¨æ„å­è¡¨åºå·æ˜¯ä»0å¼€å§‹çš„ï¼‰ã€‚</p>
<p class="a4">æ‰€æœ‰çš„å­è¡¨å¿…é¡»åœ¨DBçš„åŒä¸€ä¸ªdatabaseé‡Œã€‚</p>
<p class="a4">å½“é€šè¿‡Atlasæ‰§è¡Œï¼ˆSELECTã€DELETEã€UPDATEã€INSERTã€REPLACEï¼‰æ“ä½œæ—¶ï¼ŒAtlasä¼šæ ¹æ®åˆ†è¡¨ç»“æœï¼ˆid%2=kï¼‰ï¼Œå®šä½åˆ°ç›¸åº”çš„å­è¡¨ï¼ˆstu_kï¼‰ã€‚</p>
<p class="a4">ä¾‹å¦‚ï¼Œæ‰§è¡Œselect * from stu where id=3;ï¼ŒAtlasä¼šè‡ªåŠ¨ä»stu_1è¿™å¼ å­è¡¨è¿”å›æŸ¥è¯¢ç»“æœã€‚</p>
<p class="a4">ä½†å¦‚æœæ‰§è¡ŒSQLè¯­å¥ï¼ˆselect * from stu;ï¼‰æ—¶ä¸å¸¦ä¸Šidï¼Œåˆ™ä¼šæç¤ºæ‰§è¡Œstuè¡¨ä¸å­˜åœ¨ã€‚</p>
</blockquote>
</div>
<p><span style="background-color: #00ff00;">AtlesåŠŸèƒ½çš„è¯´æ˜</span></p>
<div>
<blockquote>
<p class="a4">Atlasæš‚ä¸æ”¯æŒè‡ªåŠ¨å»ºè¡¨å’Œè·¨åº“åˆ†è¡¨çš„åŠŸèƒ½ã€‚</p>
<p class="a4">Atlasç›®å‰æ”¯æŒåˆ†è¡¨çš„è¯­å¥æœ‰SELECTã€DELETEã€UPDATEã€INSERTã€REPLACEã€‚</p>
</blockquote>
</div>
<p><span style="background-color: #00ff00;"><strong>IP</strong><strong>è¿‡æ»¤ï¼šclient-ips</strong></span></p>
<p>ã€€ã€€è¯¥å‚æ•°ç”¨æ¥å®ç°IPè¿‡æ»¤åŠŸèƒ½ã€‚</p>
<p>ã€€ã€€åœ¨ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºç›´æ¥è¿æ¥DBï¼Œå› æ­¤DBä¼šå¯¹éƒ¨ç½²åº”ç”¨çš„æœºå™¨(æ¯”å¦‚webæœåŠ¡å™¨)çš„IPä½œè®¿é—®æˆæƒã€‚</p>
<p>åœ¨å¼•å…¥ä¸­é—´å±‚åï¼Œå› ä¸ºè¿æ¥DBçš„æ˜¯Atlasï¼Œæ‰€ä»¥DBæ”¹ä¸ºå¯¹éƒ¨ç½²Atlasçš„æœºå™¨çš„IPä½œè®¿é—®æˆæƒï¼Œå¦‚æœä»»æ„ä¸€å°å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥Atlasï¼Œå°±ä¼šå¸¦æ¥æ½œåœ¨çš„é£é™©ã€‚</p>
<p>ã€€ã€€client-ipså‚æ•°ç”¨æ¥æ§åˆ¶è¿æ¥Atlasçš„å®¢æˆ·ç«¯çš„IPï¼Œå¯ä»¥æ˜¯ç²¾ç¡®IPï¼Œä¹Ÿå¯ä»¥æ˜¯IPæ®µï¼Œä»¥é€—å·åˆ†éš”å†™åœ¨ä¸€è¡Œä¸Šå³å¯ã€‚</p>
<p>ã€€ã€€å¦‚ï¼š&nbsp;<span class="cnblogs_code">client<span style="color: #808080;">-</span>ips<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">1.2</span>, <span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">2</span></span>&nbsp;</p>
<div>
<p class="a4">ã€€ã€€è¿™å°±ä»£è¡¨192.168.1.2è¿™ä¸ªIPå’Œ192.168.2.*è¿™ä¸ªæ®µçš„IPå¯ä»¥è¿æ¥Atlasï¼Œå…¶ä»–IPå‡ä¸èƒ½è¿æ¥ã€‚å¦‚æœè¯¥å‚æ•°ä¸è®¾ç½®ï¼Œåˆ™ä»»æ„IPå‡å¯è¿æ¥Atlasã€‚å¦‚æœè®¾ç½®äº†client-ipså‚æ•°ï¼Œä¸”Atlaså‰é¢æŒ‚æœ‰LVSï¼Œåˆ™å¿…é¡»è®¾ç½®lvs-ipså‚æ•°ï¼Œå¦åˆ™å¯ä»¥ä¸è®¾ç½®lvs-ipsã€‚</p>
</div>
<p><strong>SQL</strong><strong>è¯­å¥é»‘ç™½åå•åŠŸèƒ½ï¼š</strong> Atlasä¼šå±è”½ä¸å¸¦whereæ¡ä»¶çš„deleteå’Œupdateæ“ä½œï¼Œä»¥åŠsleepå‡½æ•°ã€‚</p>
<h2>1.8 Atlas-Shardingç‰ˆæœ¬</h2>
<h3>1.8.1 ç‰ˆæœ¬ä»‹ç»</h3>
<p>ã€€ã€€Shardingçš„åŸºæœ¬æ€æƒ³å°±æ˜¯æŠŠä¸€ä¸ªæ•°æ®è¡¨ä¸­çš„æ•°æ®åˆ‡åˆ†æˆå¤šä¸ªéƒ¨åˆ†,&nbsp; å­˜æ”¾åˆ°ä¸åŒçš„ä¸»æœºä¸Šå»(åˆ‡åˆ†çš„ç­–ç•¥æœ‰å¤šç§),&nbsp; ä»è€Œç¼“è§£å•å°æœºå™¨çš„æ€§èƒ½è·Ÿå®¹é‡çš„é—®é¢˜.</p>
<p>ã€€ã€€shardingæ˜¯ä¸€ç§æ°´å¹³åˆ‡åˆ†, é€‚ç”¨äºå•è¡¨æ•°æ®åºå¤§çš„æƒ…æ™¯. ç›®å‰atlasæ”¯æŒé™æ€çš„</p>
<p>ã€€ã€€shardingæ–¹æ¡ˆ, æš‚æ—¶ä¸æ”¯æŒæ•°æ®çš„è‡ªåŠ¨è¿ç§»ä»¥åŠæ•°æ®ç»„çš„åŠ¨æ€åŠ å…¥.</p>
<p>ã€€ã€€Atlasä»¥è¡¨ä¸ºå•ä½sharding, åŒä¸€ä¸ªæ•°æ®åº“å†…å¯ä»¥åŒæ—¶å…±æœ‰shardingçš„è¡¨å’Œä¸shardingçš„è¡¨, ä¸shardingçš„è¡¨æ•°æ®å­˜åœ¨æœªshardingçš„æ•°æ®åº“ç»„ä¸­.</p>
<p>ã€€ã€€ç›®å‰Atlas shardingæ”¯æŒinsert, delete, select, updateè¯­å¥,&nbsp; åªæ”¯æŒä¸è·¨shardçš„äº‹åŠ¡. æ‰€æœ‰çš„å†™æ“ä½œå¦‚insert, delete,&nbsp; updateåªèƒ½ä¸€æ¬¡å‘½ä¸­ä¸€ä¸ªç»„, å¦åˆ™ä¼šæŠ¥"ERROR 1105 (HY000):write operation&nbsp; is only allow to one dbgroup!"é”™è¯¯.</p>
<p>ã€€ã€€ç”±äºshardingå–æ›¿äº†Atlasçš„åˆ†è¡¨åŠŸèƒ½, æ‰€ä»¥åœ¨Shardingåˆ†æ”¯é‡Œé¢,&nbsp; Atlaså•æœºåˆ†è¡¨çš„åŠŸèƒ½å·²ç»ç§»é™¤, é…ç½®tableså°†ä¸ä¼šå†æœ‰æ•ˆ.</p>
<h3>1.8.2 Atlas-Shardingæ¶æ„</h3>
<p align="center">&nbsp;<img data-original="http://clsn.io/wp-content/uploads/2018/03/1190037-20171230183135851-1350555351.png" src="blank.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/blank.gif" alt="MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»" alt="" /></p>

<h3>1.8.3 Shardingé…ç½®ç¤ºä¾‹</h3>
<p>ã€€ã€€Atlasæ”¯æŒéshardingè·Ÿshardingçš„è¡¨å…±å­˜åœ¨åŒä¸€ä¸ªAtlasä¸­, 2.2.1ä¹‹å‰çš„é…ç½®å¯ä»¥ç›´æ¥è¿è¡Œ. ä¹‹å‰çš„é…ç½®å¦‚</p>
<div>
<div class="cnblogs_code">
<pre>proxy<span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.12</span>:<span style="color: #800000; font-weight: bold;">3306</span><span style="color: #000000;">
proxy</span><span style="color: #808080;">-</span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #0000ff;">only</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.13</span>:<span style="color: #800000; font-weight: bold;">3306</span>,<span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.14</span>:<span style="color: #800000; font-weight: bold;">3306</span> ... </pre>
</div>
<p>ã€€ã€€è¿™é…ç½®äº†ä¸€ä¸ªmasterå’Œä¸¤ä¸ªslave,è¿™å±äºéshardingçš„ç»„, æ‰€æœ‰éshardingçš„è¡¨è·Ÿè¯­å¥éƒ½ä¼šå‘å¾€è¿™ä¸ªç»„å†….&nbsp;</p>
<p>ã€€ã€€æ‰€ä»¥ä¹‹å‰æ²¡æœ‰Shardingçš„Atlasçš„è¡¨å¯ä»¥æ— ç¼çš„åœ¨æ–°ç‰ˆä¸Šä½¿ç”¨,</p>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #00ff00;"><strong>æ³¨æ„:</strong> </span>éShardingçš„ç»„åªèƒ½é…ç½®ä¸€ä¸ª, è€Œshardingçš„ç»„å¯ä»¥é…ç½®å¤šä¸ª. ä¸‹é¢çš„é…ç½®, é…ç½®äº†Shardingçš„ç»„,&nbsp; æ³¨æ„ä¸ä¸Šé¢çš„é…ç½®åŒºåˆ†</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">shardrule-0</span><span style="color: #ff0000;">]</span>
<span style="color: #0000ff;">table</span> <span style="color: #808080;">=</span> test.sharding_test</pre>
</div>
</div>
<p>ã€€ã€€åˆ†è¡¨åï¼Œæœ‰æ•°æ®åº“+è¡¨åç»„æˆ&nbsp; t</p>
<div>
<div class="cnblogs_code">
<pre>ype <span style="color: #808080;">=</span> range</pre>
</div>
</div>
<p>ã€€ã€€shardingç±»å‹ï¼šrange æˆ– hash</p>
<div>
<div class="cnblogs_code">
<pre>shard<span style="color: #808080;">-</span><span style="color: #0000ff;">key</span> <span style="color: #808080;">=</span> id</pre>
</div>
</div>
<p>ã€€ã€€sharding å­—æ®µ</p>
<div>
<div class="cnblogs_code">
<pre>groups <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">0</span>:<span style="color: #800000; font-weight: bold;">0</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">999</span>,<span style="color: #800000; font-weight: bold;">1</span>:<span style="color: #800000; font-weight: bold;">1000</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">1999</span></pre>
</div>
</div>
<p>ã€€ã€€åˆ†ç‰‡çš„groupï¼Œå¦‚æœæ˜¯rangeç±»å‹çš„shardingï¼Œåˆ™groupsçš„æ ¼å¼æ˜¯ï¼šgroup_id:idèŒƒå›´ã€‚å¦‚æœæ˜¯hashç±»å‹çš„shardingï¼Œåˆ™groupsçš„æ ¼å¼æ˜¯ï¼šgroup_idã€‚ä¾‹å¦‚groups = 0, 1</p>
<div>
<div class="cnblogs_code">
<pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">group-0</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
proxy</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.15</span>:<span style="color: #800000; font-weight: bold;">3306</span><span style="color: #000000;">
proxy</span><span style="color: #808080;">-</span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #0000ff;">only</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.16</span>:<span style="color: #800000; font-weight: bold;">3306</span>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">group-1</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
proxy</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.17</span>:<span style="color: #800000; font-weight: bold;">3306</span><span style="color: #000000;">
proxy</span><span style="color: #808080;">-</span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #0000ff;">only</span><span style="color: #808080;">-</span>backend<span style="color: #808080;">-</span>addresses<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">192.168</span>.<span style="color: #800000; font-weight: bold;">0.18</span>:<span style="color: #800000; font-weight: bold;">3306</span></pre>
</div>
</div>
<h3>1.8.4 Shardingé™åˆ¶</h3>
<p><span style="background-color: #00ff00;"><strong>å…³äºæ”¯æŒçš„è¯­å¥</strong></span></p>
<p>ã€€ã€€Atlas shardingåªå¯¹sqlè¯­å¥æä¾›æœ‰é™çš„æ”¯æŒ, ç›®å‰æ”¯æŒåŸºæœ¬çš„Select, insert/replace, delete,updateè¯­å¥,æ”¯æŒå…¨éƒ¨çš„Whereè¯­æ³•(SQL-92æ ‡å‡†), ä¸æ”¯æŒDDL(create drop alter)ä»¥åŠä¸€äº›ç®¡ç†è¯­å¥,DDLè¯·ç›´è¿MYSQLæ‰§è¡Œ, è¯·åªåœ¨Atlasä¸Šæ‰§è¡ŒSelect, insert, delete, update(CRUD)è¯­å¥.</p>
<p>ã€€ã€€å¯¹äºä»¥ä¸‹è¯­å¥, å¦‚æœè¯­å¥å‘½ä¸­äº†å¤šå°dbgroup, Atlaså‡æœªåšæ”¯æŒ(å¦‚æœè¯­å¥åªå‘½ä¸­äº†ä¸€ä¸ªdbgroup, å¦‚&nbsp; select count(*) from test where id < 1000, å…¶ä¸­dbgroup0èŒƒå›´æ˜¯0 - 1000,&nbsp; é‚£ä¹ˆè¿™äº›ç‰¹æ€§éƒ½æ˜¯æ”¯æŒçš„)Limit Offset(æ”¯æŒLimit)&nbsp;&nbsp;</p>
<blockquote>
<p>Order by</p>
<div>
<p class="ad">Group by&nbsp; Join</p>
<p class="ad">ON</p>
<p class="ad">Count, Max, Minç­‰å‡½æ•°</p>
</div>
</blockquote>
<p><span style="background-color: #00ff00;"><strong>å¢åŠ èŠ‚ç‚¹</strong></span></p>
<p>ã€€ã€€æ³¨æ„: æš‚æ—¶åªæ”¯æŒrangeæ–¹å¼çš„èŠ‚ç‚¹æ‰©å±•, hashæ–¹å¼ç”±äºéœ€è¦æ•°æ®è¿ç§», æš‚æ—¶æœªåšæ”¯æŒ.</p>
<p>ã€€ã€€æ‰©å±•èŠ‚ç‚¹åœ¨ä¿è¯åŸæ¥èŠ‚ç‚¹çš„èŒƒå›´ä¸æ”¹å˜çš„æƒ…å†µä¸‹, å¦‚å·²æœ‰dbgroup0ä¸ºèŒƒå›´0 - 999, dbgroup1ä¸ºèŒƒå›´ 1000-1999, è¿™ä¸ªæ—¶å€™å¯ä»¥å¢åŠ èŒƒå›´>2000çš„èŠ‚ç‚¹. å¦‚å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ä¸º2000 - 2999, ä¿®æ”¹é…ç½®æ–‡ä»¶,&nbsp; é‡å¯Atlaså³å¯.</p>
<h2>1.9 å‚è€ƒæ–‡çŒ®</h2>
<div>
<blockquote>
<p class="a4">[1]&nbsp; http://www.cnblogs.com/cenalulu/p/4309009.html</p>
<p class="a4">[2]&nbsp; https://yq.aliyun.com/articles/57731</p>
<p class="a4">[3]&nbsp; https://www.jianshu.com/p/b68e429d09c7</p>
<p class="a4">[4]&nbsp; https://www.cnblogs.com/yyhh/archive/2015/12/29/5084844.html</p>
<p class="a4">[5]&nbsp; http://blog.csdn.net/jhq0113/article/details/44302703</p>
<p class="a4">[6]&nbsp; http://blog.csdn.net/jhq0113/article/details/44239823</p>
<p class="a4">[7]&nbsp; https://www.guokr.com/blog/475765/</p>
<p class="a4">[8]&nbsp; http://blog.csdn.net/bluishglc/article/details/6161475/</p>
</blockquote>
</div>
<p>&nbsp;</p>
  </div> <div class="s-weixin-one"> <div class="weimg-one"> <img src="clsn_linux.bmp" tppabs="http://clsn.io/wp-content/uploads/2018/09/clsn_linux.bmp" alt="weinxin" /> <div class="weixin-h"><strong>æƒ¨ç»¿å°‘å¹´Linux</strong></div> <div class="weixin-h-w">è¿™æ˜¯æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·æ‰«ä¸€æ‰«</div> <div class="clear"></div> </div></div> <div class="clear"></div><div id="social"> <div class="social-main"> <span class="like"> <a href="javascript:;" data-action="ding" data-id="290" title="ç‚¹èµ" class="dingzan"><i class="be be-thumbs-up-o"></i>èµ <i class="count"> 0</i> </a> </span> <div class="shang-p"> <div class="shang-empty"><span></span></div> <span class="tipso_style" id="tip-p" data-tipso=' <span id="shang"> <span class="shang-main"> <h4><i class="be be-favorite" aria-hidden="true"></i> æ‚¨å¯ä»¥é€‰æ‹©ä¸€ç§æ–¹å¼èµåŠ©æœ¬ç«™</h4> <span class="clear"></span> </span> </span>'> <span class="shang-s"><a title="èµåŠ©æœ¬ç«™">èµ</a></span> </span> </div> <div class="share-sd"> <span class="share-s"><a href="javascript:void(0)" id="share-s" title="åˆ†äº«"><i class="be be-share"></i>åˆ†äº«</a></span> <div id="share"> <ul class="bdsharebuttonbox"> <li><a title="æ›´å¤š" class="bds_more be be-addbox" data-cmd="more" onclick="return false;" href="#"></a></li> <li><a title="åˆ†äº«åˆ°QQç©ºé—´" class="be be-qzone" data-cmd="qzone" onclick="return false;" href="#"></a></li> <li><a title="åˆ†äº«åˆ°æ–°æµªå¾®åš" class="be be-stsina" data-cmd="tsina" onclick="return false;" href="#"></a></li> <li><a title="åˆ†äº«åˆ°è…¾è®¯å¾®åš" class="be be-tqq" data-cmd="tqq" onclick="return false;" href="#"></a></li> <li><a title="åˆ†äº«åˆ°äººäººç½‘" class="be be-renren" data-cmd="renren" onclick="return false;" href="#"></a></li> <li><a title="åˆ†äº«åˆ°å¾®ä¿¡" class="be be-weixin" data-cmd="weixin" onclick="return false;" href="#"></a></li> </ul></div> </div> <div class="clear"></div> </div></div> <footer class="single-footer"> <ul id="fontsize"><li>A+</li></ul><div class="single-cat-tag"><div class="single-cat">æ‰€å±åˆ†ç±»ï¼š<a href="javascript:if(confirm('http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/'" tppabs="http://clsn.io/clsn-ops/linux%e8%bf%90%e7%bb%b4/" rel="category tag">Linuxè¿ç»´</a> <a href="javascript:if(confirm('http://clsn.io/clsn-ops/databases/mysql/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/databases/mysql/'" tppabs="http://clsn.io/clsn-ops/databases/mysql/" rel="category tag">MySQL</a> <a href="index-6.htm" tppabs="http://clsn.io/clsn-ops/ops-linux/storage/" rel="category tag">å­˜å‚¨</a> <a href="javascript:if(confirm('http://clsn.io/clsn-ops/ops-linux/acl/  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn-ops/ops-linux/acl/'" tppabs="http://clsn.io/clsn-ops/ops-linux/acl/" rel="category tag">å®‰å…¨</a> <a href="index-16.htm" tppabs="http://clsn.io/clsn-ops/dev-ops/" rel="category tag">æ•æ·å¼€å‘</a></div></div> </footer><!-- .entry-footer --> <div class="clear"></div> </div><!-- .entry-content --> </article><!-- #post --><div class="single-tag"></div> <div class="authorbio wow fadeInUp" data-wow-delay="0.3s"> <img alt='' src="92aaa21455d7edf078accf7a7b75ee76-s=64&r=g&default=-wp-content-themes-clsn-003-img-avatar-96-latin_c.png" tppabs="https://cn.gravatar.com/avatar/92aaa21455d7edf078accf7a7b75ee76?s=64&r=g&default=%2Fwp-content%2Fthemes%2Fclsn-003%2Fimg%2Favatar%2F96%2Flatin_c.png" class='avatar avatar-64 photo wpfla ' width='64' height='64' /> <ul class="spostinfo"> <li> <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ç«™åŸåˆ›æ–‡ç« ï¼Œäº2018å¹´1æœˆ5æ—¥<i class="i-time">02:49:00</i>ï¼Œç”± <b><a href="index-36.htm" tppabs="http://clsn.io/clsn/lxauthor/clsn/" title="ç”±æƒ¨ç»¿å°‘å¹´å‘å¸ƒ" rel="author">æƒ¨ç»¿å°‘å¹´</a></b> å‘è¡¨ï¼Œå…± 31206 å­—ã€‚</li> <li class="reprinted"><strong>è½¬è½½è¯·æ³¨æ˜ï¼š</strong><a href="lx290.html" tppabs="http://clsn.io/clsn/lx290.html" rel="bookmark" title="æœ¬æ–‡å›ºå®šé“¾æ¥ http://clsn.io/clsn/lx290.html">MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦» | æƒ¨ç»¿å°‘å¹´</a></li> </ul> <div class="clear"></div></div> <div id="related-img" class="wow fadeInUp" data-wow-delay="0.3s"> <div class="r4"> <div class="related-site"> <figure class="related-site-img"> <span class="load"><a href="javascript:if(confirm('http://clsn.io/clsn/lx1086.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx1086.html'" tppabs="http://clsn.io/clsn/lx1086.html"><img src="loading.png" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/loading.png" data-original="/wp-content/themes/clsn-003/timthumb.php?src=/wp-content/uploads/2018/09/1190037-20180205204316029-486521233.png&w=280&h=210&a=&zc=1" alt="AWKå¸¸ç”¨æŠ€å·§" /></a></span> </figure> <div class="related-title"><a href="javascript:if(confirm('http://clsn.io/clsn/lx1086.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx1086.html'" tppabs="http://clsn.io/clsn/lx1086.html">AWKå¸¸ç”¨æŠ€å·§</a></div> </div> </div> <div class="r4"> <div class="related-site"> <figure class="related-site-img"> <span class="load"><a href="lx1088.html" tppabs="http://clsn.io/clsn/lx1088.html"><img src="loading.png" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/loading.png" data-original="/wp-content/themes/clsn-003/timthumb.php?src=/wp-content/uploads/2018/09/1190037-20180612203730808-1316825229.png&w=280&h=210&a=&zc=1" alt="Webç¼“å­˜çŸ¥è¯†ä½“ç³»" /></a></span> </figure> <div class="related-title"><a href="lx1088.html" tppabs="http://clsn.io/clsn/lx1088.html">Webç¼“å­˜çŸ¥è¯†ä½“ç³»</a></div> </div> </div> <div class="r4"> <div class="related-site"> <figure class="related-site-img"> <span class="load"><a href="lx1090.html" tppabs="http://clsn.io/clsn/lx1090.html"><img src="loading.png" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/loading.png" data-original="/wp-content/themes/clsn-003/timthumb.php?src=/wp-content/uploads/2018/09/1190037-20180604214121023-576776588.png&w=280&h=210&a=&zc=1" alt="ç›‘æ§å‘½ä»¤ä¹‹tsar" /></a></span> </figure> <div class="related-title"><a href="lx1090.html" tppabs="http://clsn.io/clsn/lx1090.html">ç›‘æ§å‘½ä»¤ä¹‹tsar</a></div> </div> </div> <div class="r4"> <div class="related-site"> <figure class="related-site-img"> <span class="load"><a href="javascript:if(confirm('http://clsn.io/clsn/lx1092.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx1092.html'" tppabs="http://clsn.io/clsn/lx1092.html"><img src="loading.png" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/loading.png" data-original="/wp-content/themes/clsn-003/img/random/12.jpg" alt="æ—¥å¿—åˆ‡å‰²ä¹‹Logrotate" /></a></span> </figure> <div class="related-title"><a href="javascript:if(confirm('http://clsn.io/clsn/lx1092.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx1092.html'" tppabs="http://clsn.io/clsn/lx1092.html">æ—¥å¿—åˆ‡å‰²ä¹‹Logrotate</a></div> </div> </div> <div class="clear"></div></div> <div id="single-widget"> <div class="wow fadeInUp" data-wow-delay="0.3s"> <aside id="feed-2" class="widget feed wow fadeInUp" data-wow-delay="0.3s"><h3 class="widget-title"><span class="s-icon"></span>å…³æ³¨æˆ‘ä»¬</h3><div id="feed_widget"> <div class="feed-rss"> <ul> <li class="weixin"> <span class="tipso_style" id="tip-w-j" data-tipso='<span class="weixin-qr"><img src="clsn_linux.bmp" tppabs="http://clsn.io/wp-content/uploads/2018/09/clsn_linux.bmp" alt="weixin"/></span>'><a title="å¾®ä¿¡"><i class="be be-weixin"></i></a></span> </li> <li class="feed"><a title="è®¢é˜…" href="index-23.htm" tppabs="http://clsn.io/feed/" target="_blank" rel="external nofollow"><i class="be be-rss"></i></a></li> <li class="tsina"><a title="" href="javascript:if(confirm('https://weibo.com/236567300  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ´ËÒ»µØÖ·Ê¹ÓÃÉĞÎ´Ö§³ÖµÄĞ­Òé (ÀıÈç£¬gopher)¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='https://weibo.com/236567300'" tppabs="https://weibo.com/236567300" target="_blank" rel="external nofollow"><i class="be be-stsina"></i></a></li> <li class="tqq"><a title="" href="javascript:if(confirm('https://weibo.com/236567300  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ´ËÒ»µØÖ·Ê¹ÓÃÉĞÎ´Ö§³ÖµÄĞ­Òé (ÀıÈç£¬gopher)¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='https://weibo.com/236567300'" tppabs="https://weibo.com/236567300" target="_blank" rel="external nofollow"><i class="be be-tqq"></i></a></li> </ul> </div></div><div class="clear"></div></aside><aside id="related_post-2" class="widget related_post wow fadeInUp" data-wow-delay="0.3s"><div id="related_post_widget"> <ul> <li><a href="javascript:if(confirm('http://clsn.io/clsn/lx1086.html  \n\nÎÄ¼ş²¢Î´ÒÀ Teleport Pro È¡»Ø£¬ÒòÎª ËüÎŞ·¨È¡µÃ£¬»òÖøËüÈ¡»Øºó·ÅÆú£¬»òÊÇÏîÄ¿Í£Ö¹µÄÌ«¿ì¡£  \n\nÄãÒª´Ó·şÎñÆ÷ÉÏ´ò¿ªËüÂğ£¿'))window.location='http://clsn.io/clsn/lx1086.html'" tppabs="http://clsn.io/clsn/lx1086.html">AWKå¸¸ç”¨æŠ€å·§</a></li> <li><a href="lx1088.html" tppabs="http://clsn.io/clsn/lx1088.html">Webç¼“å­˜çŸ¥è¯†ä½“ç³»</a></li> <li><a href="lx1090.html" tppabs="http://clsn.io/clsn/lx1090.html">ç›‘æ§å‘½ä»¤ä¹‹tsar</a></li> </ul></div><div class="clear"></div></aside> </div> <div class="clear"></div></div> <nav class="nav-single wow fadeInUp" data-wow-delay="0.3s"> <a href="lx300.html" tppabs="http://clsn.io/clsn/lx300.html" rel="prev"><span class="meta-nav"><span class="post-nav"><i class="be be-arrowleft"></i> ä¸Šä¸€ç¯‡</span><br/>MySQL Replication ä¸»ä»å¤åˆ¶å…¨æ–¹ä½è§£å†³æ–¹æ¡ˆ</span></a><a href="lx287.html" tppabs="http://clsn.io/clsn/lx287.html" rel="next"><span class="meta-nav"><span class="post-nav">ä¸‹ä¸€ç¯‡ <i class="be be-arrowright"></i></span><br/>MySQL ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ</span></a> <div class="clear"></div> </nav> <nav class="navigation post-navigation" role="navigation"> <h2 class="screen-reader-text">æ–‡ç« å¯¼èˆª</h2> <div class="nav-links"><div class="nav-previous"><a href="lx300.html" tppabs="http://clsn.io/clsn/lx300.html" rel="prev"><span class="meta-nav-r" aria-hidden="true"><i class="be be-arrowleft"></i></span></a></div><div class="nav-next"><a href="lx287.html" tppabs="http://clsn.io/clsn/lx287.html" rel="next"><span class="meta-nav-l" aria-hidden="true"><i class="be be-arrowright"></i></span></a></div></div> </nav> <!-- å¼•ç”¨ --><div class="scroll-comments"></div><div id="comments" class="comments-area"> <div id="respond" class="comment-respond wow fadeInUp" data-wow-delay="0.3s"> <h3 id="reply-title" class="comment-reply-title"><span>å‘è¡¨è¯„è®º</span><small><a rel="nofollow" id="cancel-comment-reply-link" href="lx290.html#respond" tppabs="http://clsn.io/clsn/lx290.html#respond" style="display:none;">å–æ¶ˆå›å¤</a></small></h3> <form action="http://clsn.io/wp-comments-post.php" method="post" id="commentform"> <p class="emoji-box"><script data-cfasync="false" src="email-decode.min.js" tppabs="http://clsn.io/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">/* <![CDATA[ */ function grin(tag) { var myField; tag = ' ' + tag + ' '; if (document.getElementById('comment') && document.getElementById('comment').type == 'textarea') { myField = document.getElementById('comment'); } else { return false; } if (document.selection) { myField.focus(); sel = document.selection.createRange(); sel.text = tag; myField.focus(); } else if (myField.selectionStart || myField.selectionStart == '0') { var startPos = myField.selectionStart; var endPos = myField.selectionEnd; var cursorPos = endPos; myField.value = myField.value.substring(0, startPos) + tag + myField.value.substring(endPos, myField.value.length); cursorPos += tag.length; myField.focus(); myField.selectionStart = cursorPos; myField.selectionEnd = cursorPos; } else { myField.value += tag; myField.focus(); } }/* ]]> */</script><a href="javascript:grin(':?:')"><img src="icon_question.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_question.gif" alt=":?:" title="ç–‘é—®" /></a><a href="javascript:grin(':razz:')"><img src="icon_razz.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_razz.gif" alt=":razz:" title="è°ƒçš®" /></a><a href="javascript:grin(':sad:')"><img src="icon_sad.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_sad.gif" alt=":sad:" title="éš¾è¿‡" /></a><a href="javascript:grin(':evil:')"><img src="icon_evil.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_evil.gif" alt=":evil:" title="æŠ é¼»" /></a><a href="javascript:grin(':!:')"><img src="icon_exclaim.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_exclaim.gif" alt=":!:" title="å“" /></a><a href="javascript:grin(':smile:')"><img src="icon_smile.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_smile.gif" alt=":smile:" title="å¾®ç¬‘" /></a><a href="javascript:grin(':oops:')"><img src="icon_redface.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_redface.gif" alt=":oops:" title="æ†¨ç¬‘" /></a><a href="javascript:grin(':grin:')"><img src="icon_biggrin.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_biggrin.gif" alt=":grin:" title="åç¬‘" /></a><a href="javascript:grin(':eek:')"><img src="icon_surprised.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_surprised.gif" alt=":eek:" title="æƒŠè®¶" /></a><a href="javascript:grin(':shock:')"><img src="icon_eek.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_eek.gif" alt=":shock:" title="å‘å‘†" /></a><a href="javascript:grin(':???:')"><img src="icon_confused.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_confused.gif" alt=":???:" title="æ’‡å˜´" /></a><a href="javascript:grin(':cool:')"><img src="icon_cool.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_cool.gif" alt=":cool:" title="å¤§å…µ" /></a><a href="javascript:grin(':lol:')"><img src="icon_lol.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_lol.gif" alt=":lol:" title="å·ç¬‘" /></a><a href="javascript:grin(':mad:')"><img src="icon_mad.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_mad.gif" alt=":mad:" title="å’’éª‚" /></a><a href="javascript:grin(':twisted:')"><img src="icon_twisted.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_twisted.gif" alt=":twisted:" title="å‘æ€’" /></a><a href="javascript:grin(':roll:')"><img src="icon_rolleyes.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_rolleyes.gif" alt=":roll:" title="ç™½çœ¼" /></a><a href="javascript:grin(':wink:')"><img src="icon_wink.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_wink.gif" alt=":wink:" title="é¼“æŒ" /></a><a href="javascript:grin(':idea:')"><img src="icon_idea.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_idea.gif" alt=":idea:" title="é…·" /></a><a href="javascript:grin(':arrow:')"><img src="icon_arrow.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_arrow.gif" alt=":arrow:" title="æ“¦æ±—" /></a><a href="javascript:grin(':neutral:')"><img src="icon_neutral.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_neutral.gif" alt=":neutral:" title="äº²äº²" /></a><a href="javascript:grin(':cry:')"><img src="icon_cry.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_cry.gif" alt=":cry:" title="å¤§å“­" /></a><a href="javascript:grin(':mrgreen:')"><img src="icon_mrgreen.gif" tppabs="http://clsn.io/wp-content/themes/clsn-003/img/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="å‘²ç‰™" /></a><br /></p> <p class="comment-form-comment"><textarea id="comment" name="comment" rows="4" tabindex="1"></textarea></p> <p class="comment-tool"> <a class="tool-img" href='javascript:embedImage();' title="æ’å…¥å›¾ç‰‡"><i class="icon-img"></i><i class="be be-picture"></i></a> <a class="emoji" href="" title="æ’å…¥è¡¨æƒ…"><i class="be be-insertemoticon"></i></a> </p> <div id="comment-author-info"> <p class="comment-form-author"> <label for="author">æ˜µç§°<span class="required">*</span></label> <input type="text" name="author" id="author" class="commenttext" value="" tabindex="2" /> </p> <p class="comment-form-email"> <label for="email">é‚®ç®±<span class="required">*</span></label> <input type="text" name="email" id="email" class="commenttext" value="" tabindex="3" /> </p> <p class="comment-form-url"> <label for="url">ç½‘å€</label> <input type="text" name="url" id="url" class="commenttext" value="" tabindex="4" /> </p> </div> <div class="qaptcha"></div> <div class="clear"></div> <p class="form-submit"> <input id="submit" name="submit" type="submit" tabindex="5" value="æäº¤è¯„è®º"/> <input type='hidden' name='comment_post_ID' value='290' id='comment_post_ID' /><input type='hidden' name='comment_parent' id='comment_parent' value='0' /> </p> <span class="mail-notify"> <input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" class="notify" value="comment_mail_notify" /> <label for="comment_mail_notify"><span>æœ‰å›å¤æ—¶é‚®ä»¶é€šçŸ¥æˆ‘</span></label> </span> </form> </div> </div><!-- #comments --> </main><!-- .site-main --> </div><!-- .content-area --><div id="sidebar" class="widget-area all-sidebar"> <aside id="search-3" class="widget widget_search wow fadeInUp" data-wow-delay="0.3s"><h3 class="widget-title"><span class="title-i"><span class="title-i-t"></span><span class="title-i-b"></span><span class="title-i-b"></span><span class="title-i-t"></span></span>å…¨ç«™æœç´¢</h3><div class="searchbar"> <form method="get" id="searchform" action="http://clsn.io/"> <span class="search-input"> <input type="text" value="" name="s" id="s" placeholder="è¾“å…¥æœç´¢å†…å®¹" required /> <button type="submit" id="searchsubmit"><i class="be be-search"></i></button> </span> </form></div><div class="clear"></div></aside><aside id="random_post-2" class="widget random_post wow fadeInUp" data-wow-delay="0.3s"><h3 class="widget-title"><span class="title-i"><span class="title-i-t"></span><span class="title-i-b"></span><span class="title-i-b"></span><span class="title-i-t"></span></span>çƒ­ç‚¹æ–‡ç« </h3><div id="random_post_widget"> <ul> <li><a href="lx387.html" tppabs="http://clsn.io/clsn/lx387.html" rel="bookmark">JIRA æ•æ·å¼€å‘å¹³å°éƒ¨ç½²è®°å½•</a></li> <li><a href="lx493.html" tppabs="http://clsn.io/clsn/lx493.html" rel="bookmark">åšå®¢å›­åšæ–‡çˆ¬è™«æ¡ˆä¾‹æ•ˆæœ</a></li> <li><a href="lx524.html" tppabs="http://clsn.io/clsn/lx524.html" rel="bookmark">Jenkinsä¸ç½‘ç«™ä»£ç ä¸Šçº¿è§£å†³æ–¹æ¡ˆ</a></li> <li><a href="lx290.html" tppabs="http://clsn.io/clsn/lx290.html" rel="bookmark">MHAé«˜å¯ç”¨æ¶æ„ä¸Atlasè¯»å†™åˆ†ç¦»</a></li> <li><a href="lx243.html" tppabs="http://clsn.io/clsn/lx243.html" rel="bookmark">SVNæœåŠ¡å®æˆ˜åº”ç”¨æŒ‡å—</a></li> <li><a href="lx355.html" tppabs="http://clsn.io/clsn/lx355.html" rel="bookmark">Confluence å¹³å°éƒ¨ç½²è®°å½•</a></li> <li><a href="lx1038.html" tppabs="http://clsn.io/clsn/lx1038.html" rel="bookmark">Linuxä¼ä¸šè¿ç»´äººå‘˜æœ€å¸¸ç”¨150ä¸ªå‘½ä»¤æ±‡æ€»</a></li> <li><a href="lx353.html" tppabs="http://clsn.io/clsn/lx353.html" rel="bookmark">æƒ¨ç»¿å°‘å¹´æ˜¯ä»€ä¹ˆï¼Ÿ</a></li> <li><a href="lx565.html" tppabs="http://clsn.io/clsn/lx565.html" rel="bookmark">Gitè¯¦è§£åŠ githubä¸gitlabä½¿ç”¨</a></li> <li><a href="lx18.html" tppabs="http://clsn.io/clsn/lx18.html" rel="bookmark">Pythonå…¥é—¨ç¯‡</a></li> </ul></div><div class="clear"></div></aside> </div><div class="clear"></div> </div><!-- .site-content --> <div class="clear"></div> <footer id="colophon" class="site-footer" role="contentinfo"> <div class="site-info"> Copyright Â©Â 2018Â <a href="index.htm" tppabs="http://clsn.io/">æƒ¨ç»¿å°‘å¹´</a>Â Â ç‰ˆæƒæ‰€æœ‰ <span class="add-info"> </span> </div><!-- .site-info --> </footer><!-- .site-footer --><div id="login"> <div id="login-tab" class="login-tab-product"> <h2 class="login-tab-hd"> <span class="login-tab-hd-con"><a href="javascript:">ç™»å½•</a></span> <span class="login-tab-hd-con"><a href="javascript:">æ³¨å†Œ</a></span> <span class="login-tab-hd-con"><a href="javascript:">æ‰¾å›å¯†ç </a></span> </h2> <div class="login-tab-bd login-dom-display"> <div class="login-tab-bd-con login-current"> <div id="tab1_login" class="tab_content_login"> <form method="post" action="http://clsn.io/wp-login.php" class="wp-user-form"> <div class="username"> <label for="user_login">ç”¨æˆ·å</label> <input type="text" name="log" value="" size="20" id="user_login" tabindex="11" /> </div> <div class="password"> <label for="user_pass">å¯†ç </label> <input type="password" name="pwd" value="" size="20" id="user_pass" tabindex="12" /> </div> <div class="login-form"></div> <div class="login_fields"> <div class="rememberme"> <label for="rememberme"> <input type="checkbox" name="rememberme" value="forever" checked="checked" id="rememberme" tabindex="13" />è®°ä½æˆ‘çš„ç™»å½•ä¿¡æ¯ </label> </div> <input type="submit" name="user-submit" value="ç™»å½•" tabindex="14" class="user-submit" /> <input type="hidden" name="redirect_to" value="/clsn/lx290.html" /> <input type="hidden" name="user-cookie" value="1" /> </div> </form> </div> </div> <div class="login-tab-bd-con"> <div id="tab2_login" class="tab_content_login"> <form method="post" action="http://clsn.io/wp-login.php?action=register" class="wp-user-form"> <div class="username"> <label for="user_login">ç”¨æˆ·å</label> <input type="text" name="user_login" value="" size="20" id="user_login" tabindex="101" /> </div> <div class="password"> <label for="user_email">ç”µå­é‚®ä»¶åœ°å€</label> <input type="text" name="user_email" value="" size="25" id="user_email" tabindex="102" /> </div> <div class="login_fields"> <input type="submit" name="user-submit" value="æ³¨å†Œ" class="user-submit" tabindex="103" /> <input type="hidden" name="redirect_to" value="/clsn/lx290.html?register=true" /> <input type="hidden" name="user-cookie" value="1" /> </div> </form> </div> </div> <div class="login-tab-bd-con"> <div id="tab3_login" class="tab_content_login"> <p class="message">è¾“å…¥ç”¨æˆ·åæˆ–ç”µå­é‚®ç®±åœ°å€ï¼Œæ‚¨ä¼šæ”¶åˆ°ä¸€å°æ–°å¯†ç é“¾æ¥çš„ç”µå­é‚®ä»¶ã€‚</p> <form method="post" action="http://clsn.io/wp-login.php?action=lostpassword" class="wp-user-form"> <div class="username"> <label for="user_login" class="hide">ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶åœ°å€</label> <input type="text" name="user_login" value="" size="20" id="user_login" tabindex="1001" /> </div> <div class="login_fields"> <div class="login-form"></div> <input type="submit" name="user-submit" value="è·å–æ–°å¯†ç " class="user-submit" tabindex="1002" /> <input type="hidden" name="redirect_to" value="/clsn/lx290.html?reset=true" /> <input type="hidden" name="user-cookie" value="1" /> </div> </form> </div> </div> </div> </div> </div><ul id="scroll"> <li class="log log-no"><a class="log-button" title="æ–‡ç« ç›®å½•"><i class="be be-menu"></i></a><div class="log-prompt"><div class="log-arrow">æ–‡ç« ç›®å½•</div></div></li> <li><a class="scroll-home" href="index.htm" tppabs="http://clsn.io/" title="é¦–é¡µ" rel="home"><i class="be be-home"></i></a></li> <li><a class="scroll-h" title="è¿”å›é¡¶éƒ¨"><i class="be be-arrowup"></i></a></li> <li><a class="scroll-c" title="è¯„è®º"><i class="be be-speechbubble"></i></a></li> <li><a class="scroll-b" title="è½¬åˆ°åº•éƒ¨"><i class="be be-arrowdown"></i></a></li> <li class="qr-site"><a href="javascript:void(0)" class="qr" title="æœ¬é¡µäºŒç»´ç "><i class="be be-qr-code"></i><span class="qr-img"><span id="output"><img class="alignnone" src="Frog-2-1.png" tppabs="http://clsn.io/wp-content/uploads/2018/09/Frog-2-1.png" alt="icon"/></span><span class="arrow arrow-z"><i class="be be-playarrow"></i></span><span class="arrow arrow-y"><i class="be be-playarrow"></i></span></span></a></li> <script type="text/javascript">$(document).ready(function(){if(!+[1,]){present="table";} else {present="canvas";}$('#output').qrcode({render:present,text:window.location.href,width:"150",height:"150"});});</script> </ul> <script src="wb.js" tppabs="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script> <html xmlns:wb="http://open.weibo.com/wb"></div><!-- .site --><script type="text/javascript">/* é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ */var a_idx = 0;jQuery(document).ready(function($) { $("body").click(function(e) {//var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£" ,"æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");var a = new Array("clsn", "æƒ¨ç»¿å°‘å¹´", "CLSN", "clsn.io", "linux", "", "å…¬æ­£");var $i = $("<span/>").text(a[a_idx]); a_idx = (a_idx + 1) % a.length;var x = e.pageX, y = e.pageY; $i.css({"z-index": 999999999999999999999999999999999999999999999999999999999999999999999,"top": y - 20,"left": x,"position": "absolute","font-weight": "bold","color": "#ff6651" }); $("body").append($i); $i.animate({"top": y - 180,"opacity": 0 }, 1500,function() { $i.remove(); }); });});</script><script type="text/javascript" src="jquery-ui.min.js" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/jquery-ui.min.js"></script><script type="text/javascript" src="qaptcha.jquery.js" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/qaptcha.jquery.js"></script><script type="text/javascript">var QaptchaJqueryPage="/wp-content/themes/clsn-003/inc/qaptcha.jquery.php"</script><script type="text/javascript">$(document).ready(function(){$('.qaptcha').QapTcha();});</script><script type='text/javascript'>/* <![CDATA[ */var imp_data = {"ajaxurl":"http:\/\/clsn.io\/wp-admin\/admin-ajax.php","_wpnonce":"848a4b7a78"};/* ]]> */</script><script type='text/javascript' src="import.js-ver=4.9.8" tppabs="http://clsn.io/wp-content/plugins/cnblogs2wp/js/import.js?ver=4.9.8"></script><script type='text/javascript' src="slides.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/slides.js?ver=2017.07.26"></script><script type='text/javascript' src="jquery.qrcode.min.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/jquery.qrcode.min.js?ver=2017.07.26"></script><script type='text/javascript' src="sticky.js-ver=1.6.0" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/sticky.js?ver=1.6.0"></script><script type='text/javascript' src="jquery-ias.js-ver=2.2.1" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/jquery-ias.js?ver=2.2.1"></script><script type='text/javascript' src="jquery.lazyload.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/jquery.lazyload.js?ver=2017.07.26"></script><script type='text/javascript' src="tipso.js-ver=1.0.1" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/tipso.js?ver=1.0.1"></script><script type='text/javascript'>/* <![CDATA[ */var wpl_ajax_url = "\/wp-content\/themes\/clsn-003\/inc\/admin-ajax.php";/* ]]> */</script><script type='text/javascript' src="script.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/script.js?ver=2017.07.26"></script><script type='text/javascript' src="flexisel.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/flexisel.js?ver=2017.07.26"></script><script type='text/javascript' src="fancybox.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/fancybox.js?ver=2017.07.26"></script><script type='text/javascript' src="comments-ajax-qt.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/comments-ajax-qt.js?ver=2017.07.26"></script><script type='text/javascript' src="superfish.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/superfish.js?ver=2017.07.26"></script><script type='text/javascript' src="bd-share.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/bd-share.js?ver=2017.07.26"></script><script type='text/javascript' src="wpzm.js-ver=2017.07.26" tppabs="http://clsn.io/wp-content/themes/clsn-003/js/wpzm.js?ver=2017.07.26"></script><script type="text/javascript">var ias=$.ias({container:"#comments",item:".comment-list",pagination:".scroll-links",next:".scroll-links .nav-previous a",});ias.extension(new IASTriggerExtension({text:'<i class="be be-circledown"></i>æ›´å¤š',offset: 0,}));ias.extension(new IASSpinnerExtension());ias.extension(new IASNoneLeftExtension({text:'å·²æ˜¯æœ€å',}));ias.on('rendered',function(items){$("img").lazyload({effect: "fadeIn",failure_limit: 10});});</script></body></html>